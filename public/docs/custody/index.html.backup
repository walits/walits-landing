<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Walits Custody Wallet - API Documentation</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
  <style>
    .menu-item.active { background-color: rgb(59 130 246); color: white; }
    .content-section { display: none; }
    .content-section.active { display: block; }
    pre[class*="language-"] { border-radius: 8px; margin: 1rem 0; }
    .method-badge { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; }
    .method-get { background-color: #3b82f6; color: white; }
    .method-post { background-color: #22c55e; color: white; }
    .method-put { background-color: #f59e0b; color: white; }
    .method-delete { background-color: #ef4444; color: white; }
    .endpoint-card { border: 1px solid #e5e7eb; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; }
    .endpoint-card:hover { border-color: #3b82f6; background-color: #f9fafb; }
  </style>
</head>
<body class="bg-gray-50">
  <!-- Header -->
  <header class="bg-blue-600 text-white shadow-md">
    <div class="container mx-auto px-6 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-4">
          <a href="/" class="text-2xl font-bold hover:text-blue-200">Walits</a>
          <span class="text-blue-200 text-sm">Custody Wallet API v1.0</span>
        </div>
        <nav class="flex items-center space-x-6">
          <a href="/" class="hover:text-blue-200">Home</a>
          <a href="/docs/custody" class="hover:text-blue-200 font-semibold underline">Custody</a>
          <a href="/docs/non-custody" class="hover:text-blue-200">Non-Custody</a>
          <div class="flex items-center space-x-2 ml-4 border-l border-blue-400 pl-4">
            <a href="/docs/custody/index.ko.html" class="hover:text-blue-200 text-sm">Ìïú</a>
            <span class="text-blue-300">|</span>
            <span class="text-white font-semibold text-sm">EN</span>
          </div>
        </nav>
      </div>
    </div>
  </header>

  <div class="flex">
    <!-- Sidebar -->
    <aside class="w-64 bg-white h-screen sticky top-0 shadow-lg overflow-y-auto">
      <div class="p-6">
        <!-- Introduction -->
        <div class="space-y-1">
          <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">Introduction</div>
          <a href="#introduction" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer active">Overview</a>
          <a href="#quick-start" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Quick Start</a>
          <a href="#authentication" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Authentication</a>
          <a href="#rate-limiting" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Rate Limiting</a>
          <a href="#idempotency" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Idempotency</a>
        </div>

        <!-- Core Concepts -->
        <div class="space-y-1 mt-6">
          <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">Core Concepts</div>
          <a href="#mpc-architecture" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">MPC Architecture</a>
          <a href="#omnibus-system" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Omnibus System</a>
          <a href="#policy-engine" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Policy Engine</a>
          <a href="#auto-sweep" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Auto-Sweep</a>
        </div>

        <!-- User Flows -->
        <div class="space-y-1 mt-6">
          <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">User Flows</div>
          <a href="#deposit-flow" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Deposit Flow</a>
          <a href="#withdrawal-flow" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Withdrawal Flow</a>
          <a href="#approval-workflow" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Approval Workflow</a>
        </div>

        <!-- Balance Management -->
        <div class="space-y-1 mt-6">
          <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">Balance Management</div>
          <a href="#balance-structure" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Balance Structure</a>
          <a href="#deposit-handling" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Deposit Handling</a>
          <a href="#withdrawal-handling" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Withdrawal Handling</a>
          <a href="#balance-verification" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Balance Verification</a>
        </div>

        <!-- API Reference -->
        <div class="space-y-1 mt-6">
          <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">API Endpoints</div>
          <a href="#api-wallets" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Wallets</a>
          <a href="#api-accounts" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Virtual Accounts</a>
          <a href="#api-gas-reserve" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Gas Reserve</a>
          <a href="#api-withdrawals" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Withdrawals</a>
          <a href="#api-approvals" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Approvals</a>
          <a href="#api-policies" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Policies</a>
          <a href="#api-balances" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Balances</a>
        </div>

        <!-- Webhooks -->
        <div class="space-y-1 mt-6">
          <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">Webhooks</div>
          <a href="#webhook-events" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Webhook Events</a>
          <a href="#webhook-security" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Signature Verification</a>
          <a href="#webhook-setup" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Setup Guide</a>
        </div>

        <!-- Code Examples -->
        <div class="space-y-1 mt-6">
          <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">Code Examples</div>
          <a href="#examples-wallet" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Create Wallet</a>
          <a href="#examples-account" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Virtual Account</a>
          <a href="#examples-withdrawal" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Withdrawal Request</a>
        </div>

        <!-- Error Handling -->
        <div class="space-y-1 mt-6">
          <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">Error Handling</div>
          <a href="#error-codes" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Error Codes</a>
          <a href="#error-handling" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Best Practices</a>
        </div>

        <!-- SDK & Tools -->
        <div class="space-y-1 mt-6">
          <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">SDK & Tools</div>
          <a href="#sdk-js" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">JavaScript SDK</a>
          <a href="#sdk-python" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Python SDK</a>
          <a href="#postman" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Postman Collection</a>
        </div>

        <!-- Security & Compliance -->
        <div class="space-y-1 mt-6">
          <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">Security</div>
          <a href="#security-best-practices" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Best Practices</a>
          <a href="#key-management" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Key Management</a>
          <a href="#audit-logs" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Audit Logs</a>
        </div>

        <!-- Appendix -->
        <div class="space-y-1 mt-6">
          <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">Appendix</div>
          <a href="#data-objects" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Data Objects</a>
          <a href="#checklist" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">Integration Checklist</a>
          <a href="#faq" class="menu-item block px-4 py-2 rounded hover:bg-gray-100 cursor-pointer">FAQ</a>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-8 max-w-5xl">
      <!-- Introduction -->
      <section id="introduction" class="content-section active">
        <h1 class="text-4xl font-bold mb-4">Walits Custody API</h1>
        <p class="text-gray-600 text-lg mb-6">Enterprise-grade MPC 2-of-3 custody solution for exchanges, banks, and institutional asset managers</p>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-6">
          <p class="font-semibold text-blue-900 text-lg mb-2">What is Walits Custody?</p>
          <p class="text-blue-800">Walits Custody is a B2B cryptocurrency custody solution that securely protects enterprise assets through <strong>MPC 2-of-3 threshold signatures</strong>, <strong>policy-based governance</strong>, and <strong>self-recovery mechanisms</strong>. Unlike Fireblocks/BitGo, Walits ensures you always retain 1/3 of the key share - eliminating single point of failure (SPOF) risks.</p>
        </div>

        <h2 class="text-2xl font-bold mt-8 mb-4">Key Features</h2>
        <div class="grid grid-cols-2 gap-4">
          <div class="border border-gray-200 rounded-lg p-4 hover:border-blue-500 transition-colors">
            <div class="flex items-center mb-2">
              <svg class="w-6 h-6 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
              </svg>
              <h3 class="font-semibold text-lg">MPC 2-of-3 Security</h3>
            </div>
            <p class="text-sm text-gray-600">CGGMP24 protocol with self-recovery - you always control 1/3 key share</p>
          </div>

          <div class="border border-gray-200 rounded-lg p-4 hover:border-blue-500 transition-colors">
            <div class="flex items-center mb-2">
              <svg class="w-6 h-6 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
              </svg>
              <h3 class="font-semibold text-lg">Omnibus + Virtual Accounts</h3>
            </div>
            <p class="text-sm text-gray-600">Efficient asset management with automatic sweep and consolidated custody</p>
          </div>

          <div class="border border-gray-200 rounded-lg p-4 hover:border-blue-500 transition-colors">
            <div class="flex items-center mb-2">
              <svg class="w-6 h-6 text-purple-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
              </svg>
              <h3 class="font-semibold text-lg">Policy-based Governance</h3>
            </div>
            <p class="text-sm text-gray-600">N-of-M approval workflows, spending limits, whitelists, time-locks</p>
          </div>

          <div class="border border-gray-200 rounded-lg p-4 hover:border-blue-500 transition-colors">
            <div class="flex items-center mb-2">
              <svg class="w-6 h-6 text-orange-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
              </svg>
              <h3 class="font-semibold text-lg">Real-time Webhooks</h3>
            </div>
            <p class="text-sm text-gray-600">Instant notifications for deposits, withdrawals, and approvals</p>
          </div>
        </div>

        <h2 class="text-2xl font-bold mt-8 mb-4">Supported Blockchains</h2>
        <div class="flex flex-wrap gap-3">
          <span class="px-4 py-2 bg-gray-100 rounded-full text-sm font-medium flex items-center">
            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
            Ethereum Mainnet
          </span>
          <span class="px-4 py-2 bg-gray-100 rounded-full text-sm font-medium flex items-center">
            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
            Sepolia Testnet
          </span>
          <span class="px-4 py-2 bg-gray-100 rounded-full text-sm font-medium flex items-center">
            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
            Base
          </span>
          <span class="px-4 py-2 bg-gray-100 rounded-full text-sm font-medium flex items-center">
            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
            Polygon
          </span>
          <span class="px-4 py-2 bg-gray-100 rounded-full text-sm font-medium flex items-center">
            <span class="w-2 h-2 bg-yellow-500 rounded-full mr-2"></span>
            Bitcoin (Coming Soon)
          </span>
        </div>

        <h2 class="text-2xl font-bold mt-8 mb-4">Base URL</h2>
        <div class="bg-gray-900 text-gray-100 p-4 rounded-lg font-mono text-sm">
          <div class="mb-2"><span class="text-green-400">Production:</span> https://api.walits.io</div>
          <div><span class="text-yellow-400">Testnet:</span> https://api-testnet.walits.io</div>
        </div>

        <h2 class="text-2xl font-bold mt-8 mb-4">API Versioning</h2>
        <p class="text-gray-600 mb-4">Current version: <strong>v1.0</strong>. All endpoints are prefixed with the version (e.g., <code class="bg-gray-100 px-2 py-1 rounded">/v1/wallets</code>). Breaking changes will be released as new versions.</p>
      </section>

      <!-- Quick Start -->
      <section id="quick-start" class="content-section">
        <h1 class="text-4xl font-bold mb-4">Quick Start Guide</h1>
        <p class="text-gray-600 text-lg mb-6">Get started with Walits Custody API in 5 minutes</p>

        <h2 class="text-2xl font-bold mt-8 mb-4">Step 1: Get API Credentials</h2>
        <p class="text-gray-600 mb-4">Contact our sales team at <a href="mailto:sales@walits.com" class="text-blue-600 hover:underline">sales@walits.com</a> to request API credentials. You'll receive:</p>
        <pre><code class="language-json">{
  "apiKey": "bbit_live_a1b2c3d4e5f6g7h8i9j0",
  "apiSecret": "sk_x1y2z3a4b5c6d7e8f9g0",
  "organizationId": "org_xyz789"
}</code></pre>
        <div class="bg-red-50 border-l-4 border-red-500 p-4 mt-4">
          <p class="font-semibold text-red-900">‚ö†Ô∏è Security Warning</p>
          <p class="text-red-800 mt-2">Store <code>apiSecret</code> securely - it's shown only once. Never commit to version control.</p>
        </div>

        <h2 class="text-2xl font-bold mt-8 mb-4">Step 2: Create Your First Custody Wallet</h2>
        <pre><code class="language-bash">curl -X POST https://api.walits.io/wallets/custody \
  -H "X-API-Key: bbit_live_xxx" \
  -H "X-API-Secret: sk_xxx" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "My First Wallet",
    "label": "Primary Hot Wallet",
    "policyId": "pol_default",
    "coinType": "ethereum",
    "organizationId": "org_xyz789",
    "autoSweep": true,
    "sweepThreshold": "0.1"
  }'</code></pre>

        <h3 class="text-xl font-semibold mt-6 mb-2">Response</h3>
        <pre><code class="language-json">{
  "id": "wal_abc123",
  "omnibusAddress": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb",
  "masterPubkey": "0x04a1b2c3...",
  "walletType": "CUSTODY",
  "createdAt": "2025-12-09T00:00:00Z"
}</code></pre>

        <h2 class="text-2xl font-bold mt-8 mb-4">Step 3: Create Virtual Accounts (Deposit Addresses)</h2>
        <pre><code class="language-bash">curl -X POST https://api.walits.io/wallets/custody/wal_abc123/accounts \
  -H "X-API-Key: bbit_live_xxx" \
  -H "X-API-Secret: sk_xxx" \
  -H "Content-Type: application/json" \
  -d '{
    "label": "Customer Alice"
  }'</code></pre>

        <h2 class="text-2xl font-bold mt-8 mb-4">Step 4: Set Up Webhooks</h2>
        <p class="text-gray-600 mb-4">Configure your webhook endpoint in the dashboard to receive real-time notifications:</p>
        <div class="bg-blue-50 border-l-4 border-blue-500 p-4">
          <p class="text-blue-900"><strong>Webhook URL:</strong> https://your-server.com/webhooks/walits</p>
          <p class="text-blue-800 mt-2">Events: <code>DEPOSIT_DETECTED</code>, <code>DEPOSIT_CONFIRMED</code>, <code>WITHDRAWAL_EXECUTED</code></p>
        </div>

        <h2 class="text-2xl font-bold mt-8 mb-4">Next Steps</h2>
        <ul class="list-disc list-inside text-gray-700 space-y-2">
          <li>Read the <a href="#mpc-architecture" class="text-blue-600 hover:underline">MPC Architecture</a> guide</li>
          <li>Understand the <a href="#deposit-flow" class="text-blue-600 hover:underline">Deposit Flow</a></li>
          <li>Configure <a href="#policy-engine" class="text-blue-600 hover:underline">Approval Policies</a></li>
          <li>Implement <a href="#webhook-security" class="text-blue-600 hover:underline">Webhook Verification</a></li>
        </ul>
      </section>

      <!-- Authentication -->
      <section id="authentication" class="content-section">
        <h1 class="text-4xl font-bold mb-4">Authentication</h1>
        <p class="text-gray-600 text-lg mb-6">Walits uses API Key + Secret authentication for all requests</p>

        <h2 class="text-2xl font-bold mt-8 mb-4">Authentication Headers</h2>
        <p class="text-gray-600 mb-4">Include these headers in every API request:</p>
        <pre><code class="language-bash">X-API-Key: bbit_live_a1b2c3d4e5f6g7h8i9j0
X-API-Secret: sk_x1y2z3a4b5c6d7e8f9g0
Content-Type: application/json</code></pre>

        <h2 class="text-2xl font-bold mt-8 mb-4">API Key Types</h2>
        <table class="min-w-full border border-gray-200 mt-4">
          <thead>
            <tr class="bg-gray-50">
              <th class="border border-gray-200 px-4 py-2 text-left">Type</th>
              <th class="border border-gray-200 px-4 py-2 text-left">Prefix</th>
              <th class="border border-gray-200 px-4 py-2 text-left">Environment</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2">Live API Key</td>
              <td class="border border-gray-200 px-4 py-2"><code>bbit_live_</code></td>
              <td class="border border-gray-200 px-4 py-2">Production</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2">Test API Key</td>
              <td class="border border-gray-200 px-4 py-2"><code>bbit_test_</code></td>
              <td class="border border-gray-200 px-4 py-2">Testnet (Sepolia)</td>
            </tr>
          </tbody>
        </table>

        <h2 class="text-2xl font-bold mt-8 mb-4">Permissions</h2>
        <p class="text-gray-600 mb-4">API keys can be scoped with specific permissions:</p>
        <ul class="list-disc list-inside text-gray-700 space-y-2">
          <li><code>wallet:read</code> - View wallets and balances</li>
          <li><code>wallet:write</code> - Create and modify wallets</li>
          <li><code>withdrawal:request</code> - Request withdrawals</li>
          <li><code>approval:manage</code> - Approve/reject withdrawal requests</li>
          <li><code>policy:read</code> - View policies</li>
          <li><code>policy:write</code> - Create and modify policies</li>
        </ul>

        <h2 class="text-2xl font-bold mt-8 mb-4">Key Rotation</h2>
        <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4">
          <p class="font-semibold text-yellow-900">üîÑ Best Practice</p>
          <p class="text-yellow-800 mt-2">Rotate API keys every 90 days. Create a new key before deleting the old one to avoid service interruption.</p>
        </div>
      </section>

      <!-- Rate Limiting -->
      <section id="rate-limiting" class="content-section">
        <h1 class="text-4xl font-bold mb-4">Rate Limiting</h1>
        <p class="text-gray-600 text-lg mb-6">API rate limits protect our infrastructure and ensure fair usage</p>

        <h2 class="text-2xl font-bold mt-8 mb-4">Rate Limits</h2>
        <table class="min-w-full border border-gray-200 mt-4">
          <thead>
            <tr class="bg-gray-50">
              <th class="border border-gray-200 px-4 py-2 text-left">Endpoint Type</th>
              <th class="border border-gray-200 px-4 py-2 text-left">Per Second</th>
              <th class="border border-gray-200 px-4 py-2 text-left">Per Minute</th>
              <th class="border border-gray-200 px-4 py-2 text-left">Per Hour</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2">Read Operations (GET)</td>
              <td class="border border-gray-200 px-4 py-2">20</td>
              <td class="border border-gray-200 px-4 py-2">200</td>
              <td class="border border-gray-200 px-4 py-2">2,000</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2">Write Operations (POST/PUT)</td>
              <td class="border border-gray-200 px-4 py-2">10</td>
              <td class="border border-gray-200 px-4 py-2">100</td>
              <td class="border border-gray-200 px-4 py-2">1,000</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2">Withdrawal Requests</td>
              <td class="border border-gray-200 px-4 py-2">2</td>
              <td class="border border-gray-200 px-4 py-2">30</td>
              <td class="border border-gray-200 px-4 py-2">500</td>
            </tr>
          </tbody>
        </table>

        <h2 class="text-2xl font-bold mt-8 mb-4">Rate Limit Headers</h2>
        <p class="text-gray-600 mb-4">All responses include rate limit information:</p>
        <pre><code class="language-bash">HTTP/1.1 200 OK
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1701676800
X-RateLimit-Reset-After: 58</code></pre>

        <h2 class="text-2xl font-bold mt-8 mb-4">Handling Rate Limits</h2>
        <pre><code class="language-javascript">async function makeApiCall() {
  try {
    const response = await axios.get('https://api.walits.io/wallets');

    // Check rate limit
    const remaining = parseInt(response.headers['x-ratelimit-remaining']);
    const resetAfter = parseInt(response.headers['x-ratelimit-reset-after']);

    if (remaining < 10) {
      console.warn(`‚ö†Ô∏è Low rate limit: ${remaining} requests remaining`);
      console.warn(`Resets in ${resetAfter} seconds`);
    }

    return response.data;
  } catch (error) {
    if (error.response?.status === 429) {
      const retryAfter = error.response.headers['retry-after'];
      console.error(`Rate limit exceeded. Retry after ${retryAfter} seconds`);
      await new Promise(resolve => setTimeout(resolve, retryAfter * 1000));
      return makeApiCall(); // Retry
    }
    throw error;
  }
}</code></pre>
      </section>

      <!-- Idempotency -->
      <section id="idempotency" class="content-section">
        <h1 class="text-4xl font-bold mb-4">Idempotency</h1>
        <p class="text-gray-600 text-lg mb-6">Safely retry API requests without duplicate operations</p>

        <h2 class="text-2xl font-bold mt-8 mb-4">Idempotency Keys</h2>
        <p class="text-gray-600 mb-4">Include an <code>X-Idempotency-Key</code> header to make POST/PUT requests idempotent:</p>
        <pre><code class="language-bash">curl -X POST https://api.walits.io/wallets/custody/wal_abc/withdraw \
  -H "X-API-Key: bbit_live_xxx" \
  -H "X-API-Secret: sk_xxx" \
  -H "X-Idempotency-Key: unique-request-id-12345" \
  -H "Content-Type: application/json" \
  -d '{
    "toAddress": "0x1234...",
    "amount": "1.5"
  }'</code></pre>

        <h3 class="text-xl font-semibold mt-6 mb-2">Behavior</h3>
        <ul class="list-disc list-inside text-gray-700 space-y-2">
          <li>First request with key ‚Üí Executes normally, stores result</li>
          <li>Subsequent requests with same key within 24h ‚Üí Returns stored result (no re-execution)</li>
          <li>After 24h ‚Üí Key expires, request treated as new</li>
        </ul>

        <h2 class="text-2xl font-bold mt-8 mb-4">Generating Idempotency Keys</h2>
        <pre><code class="language-javascript">const { v4: uuidv4 } = require('uuid');

async function safeWithdrawal(walletId, toAddress, amount) {
  const idempotencyKey = uuidv4();

  try {
    const response = await axios.post(
      `https://api.walits.io/wallets/custody/${walletId}/withdraw`,
      { toAddress, amount },
      {
        headers: {
          'X-API-Key': process.env.BLOCKBIT_API_KEY,
          'X-API-Secret': process.env.BLOCKBIT_API_SECRET,
          'X-Idempotency-Key': idempotencyKey
        }
      }
    );
    return response.data;
  } catch (error) {
    // Network error? Safe to retry with same key
    if (!error.response) {
      return safeWithdrawal(walletId, toAddress, amount);
    }
    throw error;
  }
}</code></pre>

        <div class="bg-green-50 border-l-4 border-green-500 p-4 mt-6">
          <p class="font-semibold text-green-900">‚úÖ Use Cases</p>
          <ul class="list-disc list-inside text-green-800 mt-2 space-y-1">
            <li>Withdrawal requests (critical - prevents double-spending)</li>
            <li>Wallet creation</li>
            <li>Policy updates</li>
            <li>Approval actions</li>
          </ul>
        </div>
      </section>

      <!-- MPC Architecture -->
      <section id="mpc-architecture" class="content-section">
        <h1 class="text-4xl font-bold mb-4">MPC Architecture</h1>
        <p class="text-gray-600 text-lg mb-6">Understanding Walits's CGGMP24 MPC 2-of-3 Threshold Signature System</p>

        <h2 class="text-2xl font-bold mt-8 mb-4">What is MPC?</h2>
        <p class="text-gray-600 mb-4">Multi-Party Computation (MPC) allows multiple parties to jointly compute a cryptographic signature without any single party having access to the complete private key. This eliminates single points of failure.</p>

        <h2 class="text-2xl font-bold mt-8 mb-4">Key Share Distribution</h2>
        <div class="grid grid-cols-3 gap-4 mb-6">
          <div class="border-2 border-blue-500 rounded-lg p-4 text-center">
            <div class="text-3xl mb-2">üîë</div>
            <h3 class="font-semibold mb-2">Your Key Share</h3>
            <p class="text-sm text-gray-600">Stored on your infrastructure (HSM recommended)</p>
          </div>
          <div class="border-2 border-green-500 rounded-lg p-4 text-center">
            <div class="text-3xl mb-2">üîê</div>
            <h3 class="font-semibold mb-2">Walits HSM Share</h3>
            <p class="text-sm text-gray-600">Stored in Walits's AWS HSM</p>
          </div>
          <div class="border-2 border-purple-500 rounded-lg p-4 text-center">
            <div class="text-3xl mb-2">üîí</div>
            <h3 class="font-semibold mb-2">Backup Share</h3>
            <p class="text-sm text-gray-600">Encrypted and stored for disaster recovery</p>
          </div>
        </div>

        <h2 class="text-2xl font-bold mt-8 mb-4">Signature Process</h2>
        <p class="text-gray-600 mb-4">To execute a transaction, 2 out of 3 key shares must participate in the signing process:</p>
        <div class="bg-gray-100 p-6 rounded-lg">
          <ol class="list-decimal list-inside space-y-3 text-gray-700">
            <li><strong>Withdrawal Request:</strong> Initiated via API or dashboard</li>
            <li><strong>Policy Check:</strong> Approval workflow triggered based on wallet policy</li>
            <li><strong>Approval Reached:</strong> Required approvals met (e.g., 2-of-3)</li>
            <li><strong>MPC Signing:</strong> Your share + Walits share ‚Üí Generate signature</li>
            <li><strong>Broadcast:</strong> Signed transaction sent to blockchain</li>
          </ol>
        </div>

        <h2 class="text-2xl font-bold mt-8 mb-4">Self-Recovery (SPOF Elimination)</h2>
        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-6">
          <p class="font-semibold text-blue-900 text-lg mb-2">üõ°Ô∏è Industry First: Self-Recovery Mechanism</p>
          <p class="text-blue-800 mb-4">Unlike Fireblocks/BitGo where the provider controls all key shares, Walits ensures you always retain 1/3 of the key share.</p>
          <p class="text-blue-900 font-semibold">Disaster Scenario: Walits Service Shutdown</p>
          <ul class="list-disc list-inside text-blue-800 mt-2 space-y-2">
            <li>You have: Your key share (1/3) + Backup share (1/3) = 2/3 ‚úÖ</li>
            <li>You can: Reconstruct the full key ‚Üí Migrate to another wallet solution</li>
            <li>Zero downtime: Your funds are always accessible</li>
          </ul>
        </div>

        <h2 class="text-2xl font-bold mt-8 mb-4">Technical Specifications</h2>
        <table class="min-w-full border border-gray-200 mt-4">
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold bg-gray-50">Protocol</td>
              <td class="border border-gray-200 px-4 py-2">CGGMP24 (2024 Standard)</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold bg-gray-50">Curve</td>
              <td class="border border-gray-200 px-4 py-2">secp256k1 (Ethereum, Bitcoin)</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold bg-gray-50">Threshold</td>
              <td class="border border-gray-200 px-4 py-2">2-of-3 (t=2, n=3)</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold bg-gray-50">Key Generation Time</td>
              <td class="border border-gray-200 px-4 py-2">&lt;30 seconds (vs Fireblocks 5-10 min)</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold bg-gray-50">Signature Time</td>
              <td class="border border-gray-200 px-4 py-2">~1.5 seconds (vs Fireblocks 3-5 sec)</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold bg-gray-50">Throughput</td>
              <td class="border border-gray-200 px-4 py-2">100+ signatures/second (parallel)</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- ============================================ -->
      <!-- CORE CONCEPTS -->
      <!-- ============================================ -->

      <!-- Omnibus System -->
      <section id="omnibus-system" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Omnibus System</h1>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-6">
          <p class="font-semibold text-lg mb-2">üí° What is Omnibus?</p>
          <p>All customer funds are pooled into a single master address (Omnibus Address) protected by MPC 2-of-3, while individual balances are tracked via Virtual Accounts at the database level.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Architecture</h2>
        <div class="grid grid-cols-2 gap-6 mb-6">
          <div class="border-2 border-blue-500 rounded-lg p-6 bg-blue-50">
            <h3 class="text-xl font-semibold mb-3">üè¶ Omnibus Address</h3>
            <ul class="list-disc list-inside space-y-2">
              <li>Single on-chain address per asset</li>
              <li>Protected by MPC 2-of-3 threshold signature</li>
              <li>All customer deposits flow here via auto-sweep</li>
              <li>All withdrawals originate from here</li>
            </ul>
          </div>
          <div class="border-2 border-green-500 rounded-lg p-6 bg-green-50">
            <h3 class="text-xl font-semibold mb-3">üìä Virtual Accounts</h3>
            <ul class="list-disc list-inside space-y-2">
              <li>Database-level balance records</li>
              <li>Each customer gets unique deposit addresses</li>
              <li>Instant internal transfers (no gas fees)</li>
              <li>Real-time balance updates</li>
            </ul>
          </div>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Benefits</h2>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Feature</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Benefit</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Gas Optimization</td>
              <td class="border border-gray-200 px-4 py-2">Batch withdrawals from single address ‚Üí 60-80% gas savings</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Instant Internal Transfers</td>
              <td class="border border-gray-200 px-4 py-2">User A ‚Üí User B transfers are instant database updates (0 gas cost)</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Liquidity Management</td>
              <td class="border border-gray-200 px-4 py-2">Centralized pool ‚Üí Easy to manage reserves and liquidity</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Simplified Reconciliation</td>
              <td class="border border-gray-200 px-4 py-2">Single on-chain balance to track, virtual balances in DB</td>
            </tr>
          </tbody>
        </table>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Example Flow</h2>
        <pre><code class="language-plaintext">
1. Customer A deposits 10 ETH to their unique deposit address (0xABC...)
   ‚Üí Auto-sweep triggers after 1 confirmation
   ‚Üí Funds move to Omnibus Address (0xOMNI...)
   ‚Üí Virtual Account A balance: +10 ETH (database)

2. Customer B deposits 5 ETH to their deposit address (0xDEF...)
   ‚Üí Auto-sweep to Omnibus Address
   ‚Üí Virtual Account B balance: +5 ETH (database)
   ‚Üí Total Omnibus Balance: 15 ETH (on-chain)

3. Customer A transfers 3 ETH to Customer B (internal)
   ‚Üí Virtual Account A: 10 - 3 = 7 ETH ‚úÖ
   ‚Üí Virtual Account B: 5 + 3 = 8 ETH ‚úÖ
   ‚Üí Omnibus Balance: Still 15 ETH (no on-chain tx!)
   ‚Üí Execution time: <100ms (database update only)

4. Customer B withdraws 8 ETH to external address (0xEXTERNAL...)
   ‚Üí Approval workflow triggered (if policy requires)
   ‚Üí After approval: Omnibus sends 8 ETH on-chain
   ‚Üí Virtual Account B: 8 - 8 = 0 ETH
   ‚Üí Omnibus Balance: 15 - 8 = 7 ETH
        </code></pre>
      </section>

      <!-- Policy Engine -->
      <section id="policy-engine" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Policy Engine</h1>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-6">
          <p class="font-semibold text-lg mb-2">üõ°Ô∏è Governance at Protocol Level</p>
          <p>Define rules for withdrawals, approvals, spending limits, and whitelists. All policies are enforced automatically by the Walits backend.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Policy Parameters</h2>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Parameter</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Description</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Example</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">approvalThreshold</td>
              <td class="border border-gray-200 px-4 py-2">Number of approvals required (N-of-M)</td>
              <td class="border border-gray-200 px-4 py-2">2 (requires 2 admins to approve)</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">maxDailyLimit</td>
              <td class="border border-gray-200 px-4 py-2">Maximum withdrawal amount per day</td>
              <td class="border border-gray-200 px-4 py-2">"100.0" ETH</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">maxMonthlyLimit</td>
              <td class="border border-gray-200 px-4 py-2">Maximum withdrawal amount per month</td>
              <td class="border border-gray-200 px-4 py-2">"2000.0" ETH</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">whitelistOnly</td>
              <td class="border border-gray-200 px-4 py-2">Restrict withdrawals to whitelisted addresses only</td>
              <td class="border border-gray-200 px-4 py-2">true</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">autoApproveWhitelisted</td>
              <td class="border border-gray-200 px-4 py-2">Skip approval for whitelisted addresses</td>
              <td class="border border-gray-200 px-4 py-2">false</td>
            </tr>
          </tbody>
        </table>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Approval Workflow Example</h2>
        <pre><code class="language-json">
// Policy Configuration
{
  "approvalThreshold": 3,  // 3-of-5 multisig
  "maxDailyLimit": "50.0",
  "whitelistOnly": true,
  "autoApproveWhitelisted": false
}

// Withdrawal Request Flow
1. User submits withdrawal: 10 ETH to 0xABC...
   ‚Üí System checks: Is 0xABC in whitelist? ‚úÖ
   ‚Üí System checks: Daily limit exceeded? (10 < 50) ‚úÖ
   ‚Üí ApprovalRequest created with status: PENDING

2. Admin 1 approves
   ‚Üí currentApprovals: 1/3

3. Admin 2 approves
   ‚Üí currentApprovals: 2/3

4. Admin 3 approves
   ‚Üí currentApprovals: 3/3 ‚úÖ
   ‚Üí Status: APPROVED
   ‚Üí MPC signature generated
   ‚Üí Transaction broadcast to blockchain
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Comparison with Competitors</h2>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Feature</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Walits</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Fireblocks</th>
              <th class="border border-gray-200 px-4 py-3 text-left">BitGo</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Setup Time</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600">5 minutes (API)</td>
              <td class="border border-gray-200 px-4 py-2 text-orange-600">2-3 hours (UI)</td>
              <td class="border border-gray-200 px-4 py-2 text-orange-600">1-2 hours (UI)</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Dynamic Threshold</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600">‚úÖ API updateable</td>
              <td class="border border-gray-200 px-4 py-2 text-red-600">‚ùå Fixed at creation</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600">‚úÖ</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Whitelist Management</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600">‚úÖ API + Real-time</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600">‚úÖ</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600">‚úÖ</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Time-Lock</td>
              <td class="border border-gray-200 px-4 py-2 text-orange-600">Roadmap Q2 2025</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600">‚úÖ</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600">‚úÖ</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- Auto-Sweep -->
      <section id="auto-sweep" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Auto-Sweep</h1>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-6">
          <p class="font-semibold text-lg mb-2">üîÑ Automatic Fund Consolidation</p>
          <p>When enabled, user deposit addresses automatically forward funds to the Omnibus Address after a configurable number of confirmations.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Configuration</h2>
        <pre><code class="language-bash">
PUT /wallets/custody/{walletId}/sweep-settings
X-API-Key: bbit_live_xxx
X-API-Secret: sk_xxx

{
  "autoSweep": true,
  "sweepThreshold": "0.1"  // Minimum balance to trigger sweep (optional)
}

# Response
{
  "walletId": "wal_abc123",
  "autoSweep": true,
  "sweepThreshold": "0.1",
  "message": "Auto-sweep enabled. Deposits ‚â• 0.1 ETH will be swept after 1 confirmation."
}
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Sweep Timing</h2>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Blockchain</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Confirmations</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Typical Time</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Ethereum</td>
              <td class="border border-gray-200 px-4 py-2">1 confirmation</td>
              <td class="border border-gray-200 px-4 py-2">~12 seconds</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Bitcoin</td>
              <td class="border border-gray-200 px-4 py-2">3 confirmations</td>
              <td class="border border-gray-200 px-4 py-2">~30 minutes</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Polygon</td>
              <td class="border border-gray-200 px-4 py-2">1 confirmation</td>
              <td class="border border-gray-200 px-4 py-2">~2 seconds</td>
            </tr>
          </tbody>
        </table>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Gas Optimization</h2>
        <div class="bg-yellow-50 border-l-4 border-yellow-500 p-6 mb-6">
          <p class="font-semibold mb-2">‚ö° Smart Batching</p>
          <p>Walits automatically batches multiple sweep transactions when possible:</p>
          <ul class="list-disc list-inside mt-2 space-y-1">
            <li>Multiple ERC-20 deposits ‚Üí Single multicall sweep (80% gas savings)</li>
            <li>Bitcoin UTXO consolidation during low-fee periods</li>
            <li>Configurable gas price limits to avoid expensive sweeps</li>
          </ul>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Monitoring Sweeps</h2>
        <pre><code class="language-javascript">
// Webhook notification when sweep completes
{
  "event": "sweep.completed",
  "data": {
    "walletId": "wal_abc123",
    "fromAddress": "0xDEPOSIT_ADDRESS",
    "toAddress": "0xOMNIBUS_ADDRESS",
    "amount": "5.0",
    "asset": "ETH",
    "txHash": "0x123abc...",
    "gasUsed": "21000",
    "timestamp": "2024-12-09T10:30:00Z"
  }
}
        </code></pre>
      </section>

      <!-- ============================================ -->
      <!-- USER FLOWS -->
      <!-- ============================================ -->

      <!-- Deposit Flow -->
      <section id="deposit-flow" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Deposit Flow</h1>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-6">
          <p class="font-semibold text-lg mb-2">2-Stage Deposit Process</p>
          <p class="mb-3">Walits uses a two-stage confirmation process to protect against blockchain reorganizations:</p>
          <ul class="list-disc list-inside space-y-1">
            <li><strong>Stage 1 (DEPOSIT_DETECTED)</strong>: 1 confirmation - Notification only, no balance change</li>
            <li><strong>Stage 2 (DEPOSIT_CONFIRMED)</strong>: 12 confirmations - Balance updated, safe to credit user</li>
          </ul>
          <p class="mt-3 text-blue-800">See <a href="#deposit-handling" class="underline">Balance Management: Deposit Handling</a> for technical details.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Step-by-Step Process</h2>
        <div class="space-y-6">
          <div class="border-l-4 border-blue-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">Step 1: Create Virtual Account</h3>
            <pre><code class="language-bash">
POST /wallets/custody/{walletId}/virtual-accounts
X-API-Key: bbit_live_xxx
X-API-Secret: sk_xxx

{
  "userId": "user_12345",
  "label": "User John Doe - ETH Account"
}

# Response
{
  "virtualAccountId": "va_abc123",
  "depositAddress": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb",
  "walletId": "wal_abc123",
  "userId": "user_12345",
  "balance": "0.0"
}
            </code></pre>
          </div>

          <div class="border-l-4 border-green-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">Step 2: User Sends Funds</h3>
            <pre><code class="language-plaintext">
User sends 10 ETH to: 0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb
‚Üí Transaction included in block
‚Üí xScanner detects deposit (5-second scan interval)
            </code></pre>
          </div>

          <div class="border-l-4 border-yellow-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">Step 3: DEPOSIT_DETECTED (1 confirmation)</h3>
            <pre><code class="language-json">
// Webhook sent - notification only, NO balance change yet
{
  "event": "DEPOSIT_DETECTED",
  "data": {
    "accountId": "acc_123",
    "amount": "10.0",
    "txHash": "0x123abc...",
    "confirmations": 1
  }
}

// Recommended action: Show "Pending deposit" in UI
            </code></pre>
          </div>

          <div class="border-l-4 border-purple-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">Step 4: DEPOSIT_CONFIRMED (12 confirmations)</h3>
            <pre><code class="language-json">
// Webhook sent - balance IS updated now
{
  "event": "DEPOSIT_CONFIRMED",
  "data": {
    "accountId": "acc_123",
    "amount": "10.0",
    "balance": "10.0",
    "autoSweep": true,
    "txHash": "0x123abc..."
  }
}

// Backend updates:
// - balance += 10.0
// - availableBalance += 10.0
// - Triggers auto-sweep if enabled

// Recommended action: Credit user balance, allow withdrawals
            </code></pre>
          </div>

          <div class="border-l-4 border-orange-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">Step 5: Auto-Sweep (if enabled)</h3>
            <pre><code class="language-plaintext">
‚Üí Sweep transaction initiated after DEPOSIT_CONFIRMED
   FROM: 0x742d35Cc (deposit address)
   TO: 0xOMNIBUS... (omnibus address)
   AMOUNT: 10 ETH (minus gas fee ~0.001 ETH)
‚Üí SWEEP_EXECUTED webhook sent
‚Üí Funds consolidated in omnibus wallet
            </code></pre>
          </div>

          <div class="border-l-4 border-gray-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">Step 6: Customer Balance Check</h3>
            <pre><code class="language-json">
// Virtual Account balance updated (database)
{
  "virtualAccountId": "va_abc123",
  "balance": "9.999",  // 10 - 0.001 gas
  "omnibusBalance": "9.999",
  "lastDeposit": {
    "amount": "10.0",
    "txHash": "0x123abc...",
    "timestamp": "2024-12-09T10:30:00Z"
  }
}
            </code></pre>
          </div>

          <div class="border-l-4 border-red-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">Step 5: Webhook Notification</h3>
            <pre><code class="language-json">
// Your server receives webhook
POST https://your-server.com/webhooks/walits
{
  "event": "deposit.confirmed",
  "data": {
    "virtualAccountId": "va_abc123",
    "userId": "user_12345",
    "amount": "10.0",
    "asset": "ETH",
    "txHash": "0x123abc...",
    "confirmations": 1,
    "timestamp": "2024-12-09T10:30:00Z"
  }
}
            </code></pre>
          </div>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Timeline Comparison</h2>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Stage</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Walits</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Fireblocks</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Deposit Address Generation</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600">&lt;1 second (API)</td>
              <td class="border border-gray-200 px-4 py-2 text-orange-600">~5 seconds</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Deposit Detection</td>
              <td class="border border-gray-200 px-4 py-2">Real-time (WebSocket)</td>
              <td class="border border-gray-200 px-4 py-2">~30 seconds (polling)</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Sweep Trigger</td>
              <td class="border border-gray-200 px-4 py-2">1 confirmation</td>
              <td class="border border-gray-200 px-4 py-2">3 confirmations</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Webhook Delivery</td>
              <td class="border border-gray-200 px-4 py-2">&lt;100ms after detection</td>
              <td class="border border-gray-200 px-4 py-2">~1-2 minutes</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- Withdrawal Flow -->
      <section id="withdrawal-flow" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Withdrawal Flow</h1>

        <div class="bg-red-50 border-l-4 border-red-500 p-6 mb-6">
          <p class="font-semibold text-lg mb-2">Immediate Balance Hold</p>
          <p class="mb-3">To prevent double-spending, withdrawal requests <strong>immediately lock funds</strong>:</p>
          <ul class="list-disc list-inside space-y-1">
            <li><code class="bg-red-100 px-2 py-1 rounded">availableBalance</code> decreases immediately</li>
            <li><code class="bg-red-100 px-2 py-1 rounded">pendingWithdrawalBalance</code> increases immediately</li>
            <li>Second withdrawal request for same funds will fail (insufficient available balance)</li>
            <li>If withdrawal fails, balance is automatically restored (rollback)</li>
          </ul>
          <p class="mt-3 text-red-800">See <a href="#withdrawal-handling" class="underline">Balance Management: Withdrawal Handling</a> for technical details.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Step-by-Step Process</h2>
        <div class="space-y-6">
          <div class="border-l-4 border-blue-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">Step 1: Request Withdrawal (Balance Hold)</h3>
            <pre><code class="language-bash">
POST /wallets/custody/{walletId}/withdraw
X-API-Key: bbit_live_xxx
X-API-Secret: sk_xxx

{
  "toAddress": "0xRECIPIENT_ADDRESS",
  "amount": "5.0",
  "memo": "Withdrawal for user_12345"
}

# Response
{
  "approvalRequestId": "apr_xyz789",
  "status": "PENDING",
  "requiredApprovals": 2,
  "currentApprovals": 0,
  "amount": "5.0",
  "fromAddress": "0xOMNIBUS_ADDRESS",
  "toAddress": "0xRECIPIENT_ADDRESS",
  "message": "Waiting for 2 approvals"
}

# IMPORTANT: Balance hold happens IMMEDIATELY
# - availableBalance -= 5.0 (prevents double-spend)
# - pendingWithdrawalBalance += 5.0
# - WITHDRAWAL_REQUESTED webhook sent
            </code></pre>
          </div>

          <div class="border-l-4 border-green-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">Step 2: Policy Validation</h3>
            <pre><code class="language-plaintext">
System checks:
‚úÖ Is toAddress in whitelist? (if whitelistOnly = true)
‚úÖ Daily limit check: 5.0 < 50.0 (maxDailyLimit)
‚úÖ Monthly limit check: 5.0 < 2000.0 (maxMonthlyLimit)
‚úÖ Sufficient balance: 5.0 < 100.0 (omnibus balance)
‚Üí All checks passed, approval workflow starts
            </code></pre>
          </div>

          <div class="border-l-4 border-purple-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">Step 3: Approval Process</h3>
            <pre><code class="language-bash">
# Admin 1 approves
POST /approvals/{approvalRequestId}/approve
X-API-Key: admin1_key
{
  "comment": "Verified with user"
}
‚Üí currentApprovals: 1/2

# Admin 2 approves
POST /approvals/{approvalRequestId}/approve
X-API-Key: admin2_key
{
  "comment": "Approved"
}
‚Üí currentApprovals: 2/2 ‚úÖ
‚Üí Status: APPROVED
            </code></pre>
          </div>

          <div class="border-l-4 border-orange-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">Step 4: MPC Signature Generation</h3>
            <pre><code class="language-plaintext">
‚Üí Walits initiates MPC signing ceremony
‚Üí Your key share (1/3) + Walits HSM (1/3) = 2/3 ‚úÖ
‚Üí CGGMP24 threshold signature generated (~1.5 seconds)
‚Üí Transaction built and signed
            </code></pre>
          </div>

          <div class="border-l-4 border-red-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">Step 5: Blockchain Broadcast</h3>
            <pre><code class="language-json">
// Transaction broadcast to Ethereum
{
  "txHash": "0x789def...",
  "from": "0xOMNIBUS_ADDRESS",
  "to": "0xRECIPIENT_ADDRESS",
  "amount": "5.0 ETH",
  "gasPrice": "30 gwei",
  "status": "pending"
}

// Webhook: Transaction confirmed
{
  "event": "withdrawal.confirmed",
  "data": {
    "approvalRequestId": "apr_xyz789",
    "txHash": "0x789def...",
    "status": "confirmed",
    "confirmations": 12,
    "timestamp": "2024-12-09T11:00:00Z"
  }
}
            </code></pre>
          </div>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Withdrawal States</h2>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Status</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Description</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Next Action</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm bg-yellow-50">PENDING</td>
              <td class="border border-gray-200 px-4 py-2">Waiting for approvals</td>
              <td class="border border-gray-200 px-4 py-2">Admins need to approve</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm bg-blue-50">APPROVED</td>
              <td class="border border-gray-200 px-4 py-2">Threshold met, generating signature</td>
              <td class="border border-gray-200 px-4 py-2">Automatic (MPC signing)</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm bg-purple-50">BROADCASTING</td>
              <td class="border border-gray-200 px-4 py-2">Transaction sent to blockchain</td>
              <td class="border border-gray-200 px-4 py-2">Wait for confirmations</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm bg-green-50">CONFIRMED</td>
              <td class="border border-gray-200 px-4 py-2">Transaction confirmed on-chain</td>
              <td class="border border-gray-200 px-4 py-2">Complete ‚úÖ</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm bg-red-50">REJECTED</td>
              <td class="border border-gray-200 px-4 py-2">Admin(s) rejected the request</td>
              <td class="border border-gray-200 px-4 py-2">User must create new request</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- Approval Workflow -->
      <section id="approval-workflow" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Approval Workflow</h1>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-6">
          <p class="font-semibold text-lg mb-2">üîê N-of-M Approval Process</p>
          <p>Implement governance controls by requiring multiple admin approvals for sensitive operations like withdrawals.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Approval Request Lifecycle</h2>
        <pre><code class="language-plaintext">
1. PENDING ‚Üí Waiting for approvals (currentApprovals < requiredApprovals)
2. APPROVED ‚Üí Threshold met, MPC signature generation starts
3. BROADCASTING ‚Üí Transaction sent to blockchain
4. CONFIRMED ‚Üí On-chain confirmation received ‚úÖ
5. REJECTED ‚Üí Admin(s) rejected the request (terminal state) ‚ùå
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">API Endpoints</h2>
        <div class="space-y-4">
          <div class="border rounded-lg p-4">
            <h3 class="text-lg font-semibold mb-2"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm font-mono mr-2">GET</span>List Pending Approvals</h3>
            <pre><code class="language-bash">GET /approvals?status=PENDING
X-API-Key: bbit_live_xxx

# Response
{
  "approvals": [
    {
      "id": "apr_xyz789",
      "walletId": "wal_abc123",
      "type": "WITHDRAWAL",
      "amount": "5.0",
      "toAddress": "0xRECIPIENT",
      "status": "PENDING",
      "requiredApprovals": 2,
      "currentApprovals": 1,
      "approvers": [
        {
          "adminId": "admin_001",
          "approvedAt": "2024-12-09T10:00:00Z",
          "comment": "Verified"
        }
      ],
      "createdAt": "2024-12-09T09:55:00Z"
    }
  ]
}
            </code></pre>
          </div>

          <div class="border rounded-lg p-4">
            <h3 class="text-lg font-semibold mb-2"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm font-mono mr-2">POST</span>Approve Request</h3>
            <pre><code class="language-bash">POST /approvals/{approvalRequestId}/approve
X-API-Key: bbit_live_xxx

{
  "comment": "Approved after verification"
}

# Response
{
  "approvalRequestId": "apr_xyz789",
  "status": "APPROVED",  // Changed from PENDING
  "currentApprovals": 2,
  "requiredApprovals": 2,
  "message": "Threshold met. Transaction will be broadcast shortly."
}
            </code></pre>
          </div>

          <div class="border rounded-lg p-4">
            <h3 class="text-lg font-semibold mb-2"><span class="bg-red-100 text-red-800 px-2 py-1 rounded text-sm font-mono mr-2">POST</span>Reject Request</h3>
            <pre><code class="language-bash">POST /approvals/{approvalRequestId}/reject
X-API-Key: bbit_live_xxx

{
  "reason": "Suspicious withdrawal pattern"
}

# Response
{
  "approvalRequestId": "apr_xyz789",
  "status": "REJECTED",
  "rejectedBy": "admin_002",
  "reason": "Suspicious withdrawal pattern",
  "rejectedAt": "2024-12-09T10:10:00Z"
}
            </code></pre>
          </div>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Use Cases</h2>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Scenario</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Recommended Threshold</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Rationale</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Small Exchange</td>
              <td class="border border-gray-200 px-4 py-2">2-of-3</td>
              <td class="border border-gray-200 px-4 py-2">Balance between security and operational speed</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Large Exchange</td>
              <td class="border border-gray-200 px-4 py-2">3-of-5 or 4-of-7</td>
              <td class="border border-gray-200 px-4 py-2">Higher stakes require more oversight</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Corporate Treasury</td>
              <td class="border border-gray-200 px-4 py-2">2-of-4</td>
              <td class="border border-gray-200 px-4 py-2">CFO + Controller approval required</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Payment Processor</td>
              <td class="border border-gray-200 px-4 py-2">1-of-2 + Whitelist</td>
              <td class="border border-gray-200 px-4 py-2">Fast approvals for whitelisted addresses</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- ============================================ -->
      <!-- BALANCE MANAGEMENT -->
      <!-- ============================================ -->

      <!-- Balance Structure -->
      <section id="balance-structure" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Balance Structure</h1>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-6">
          <p class="font-semibold text-lg mb-2">Double-Entry Accounting System</p>
          <p>Walits Custody uses enterprise-grade balance management following the same patterns as BitGo and Fireblocks. This prevents double-spending and ensures accurate accounting.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Balance Types</h2>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Balance Type</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Description</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Update Timing</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">balance</td>
              <td class="border border-gray-200 px-4 py-2">Total balance (on-chain cached value)</td>
              <td class="border border-gray-200 px-4 py-2">Deposit confirmed, Sweep completed</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">availableBalance</td>
              <td class="border border-gray-200 px-4 py-2">Withdrawable balance (not held)</td>
              <td class="border border-gray-200 px-4 py-2">Deposit/Withdrawal requested/confirmed</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">pendingWithdrawalBalance</td>
              <td class="border border-gray-200 px-4 py-2">Funds held for pending withdrawals</td>
              <td class="border border-gray-200 px-4 py-2">Withdrawal requested/confirmed/failed</td>
            </tr>
          </tbody>
        </table>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Balance Invariant</h2>
        <div class="bg-gray-900 text-gray-100 p-6 rounded-lg font-mono mb-6">
          <div class="text-green-400 mb-4">// This relationship MUST always hold true:</div>
          <div class="text-xl">totalBalance = availableBalance + pendingWithdrawalBalance</div>
        </div>

        <div class="bg-yellow-50 border-l-4 border-yellow-500 p-6 mb-6">
          <p class="font-semibold text-yellow-900 mb-2">Important: Double-Spend Prevention</p>
          <p class="text-yellow-800">When a withdrawal is requested, <code class="bg-yellow-100 px-2 py-1 rounded">availableBalance</code> is <strong>immediately reduced</strong> and <code class="bg-yellow-100 px-2 py-1 rounded">pendingWithdrawalBalance</code> is increased. This ensures a second withdrawal request for the same funds will fail due to insufficient available balance.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Example Scenario</h2>
        <pre><code class="language-javascript">
// Initial state
{
  "balance": "10.0",
  "availableBalance": "10.0",
  "pendingWithdrawalBalance": "0.0"
}

// User requests withdrawal of 3.0 ETH
// ‚Üí Balance hold happens IMMEDIATELY
{
  "balance": "10.0",                    // unchanged
  "availableBalance": "7.0",            // 10.0 - 3.0 = 7.0
  "pendingWithdrawalBalance": "3.0"     // 0.0 + 3.0 = 3.0
}

// Withdrawal confirmed on-chain (12 confirmations)
// ‚Üí Pending balance released
{
  "balance": "7.0",                     // actual on-chain balance
  "availableBalance": "7.0",            // unchanged
  "pendingWithdrawalBalance": "0.0"     // 3.0 - 3.0 = 0.0
}
        </code></pre>
      </section>

      <!-- Deposit Handling -->
      <section id="deposit-handling" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Deposit Handling</h1>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-6">
          <p class="font-semibold text-lg mb-2">2-Stage Deposit Processing</p>
          <p>Walits uses a two-stage deposit confirmation process to protect against blockchain reorganizations (reorgs) while providing early notifications.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Deposit Stages</h2>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Stage</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Event</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Confirmations</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Balance Update</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Purpose</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Stage 1</td>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">DEPOSIT_DETECTED</td>
              <td class="border border-gray-200 px-4 py-2">1</td>
              <td class="border border-gray-200 px-4 py-2 text-red-600">No change</td>
              <td class="border border-gray-200 px-4 py-2">Early notification only</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Stage 2</td>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">DEPOSIT_CONFIRMED</td>
              <td class="border border-gray-200 px-4 py-2">12 (Sepolia/Mainnet)</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600">Balance increased</td>
              <td class="border border-gray-200 px-4 py-2">Safe to credit user</td>
            </tr>
          </tbody>
        </table>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Why 2 Stages?</h2>
        <div class="bg-gray-100 p-6 rounded-lg mb-6">
          <p class="font-semibold mb-3">Blockchain Reorg Risk</p>
          <p class="mb-4">In rare cases, blocks can be reorganized (reorg), potentially reversing transactions with few confirmations. By waiting for 12 confirmations before updating balances, we protect against this risk.</p>
          <ul class="list-disc list-inside space-y-2">
            <li><strong>DEPOSIT_DETECTED</strong> ‚Üí Show "Pending deposit" in UI, don't credit balance yet</li>
            <li><strong>DEPOSIT_CONFIRMED</strong> ‚Üí Safe to credit user balance and allow withdrawals</li>
          </ul>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Integration with xScanner</h2>
        <p class="mb-4">Walits Custody uses <strong>xScanner</strong> (Rust-based blockchain monitor) to detect and track deposits in real-time:</p>
        <pre><code class="language-plaintext">
1. xScanner scans new blocks every 5 seconds
2. Detects transaction to customer deposit address
3. Sends DEPOSIT_DETECTED event (1 confirmation)
4. Continues monitoring confirmations
5. At 12 confirmations ‚Üí Sends DEPOSIT_CONFIRMED event
6. Backend updates availableBalance and triggers auto-sweep (if enabled)
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Balance Updates</h2>
        <pre><code class="language-typescript">
// DEPOSIT_CONFIRMED handler (backend)
async handleDepositConfirmed(event: DepositEventDto) {
  const depositAmount = new Decimal(event.amount);

  await prisma.wallet.update({
    where: { id: walletId },
    data: {
      balance: { increment: depositAmount },              // total balance
      availableBalance: { increment: depositAmount },     // withdrawable balance
      lastSyncedAt: new Date(),
      lastSyncMethod: 'DEPOSIT'
    }
  });

  // Trigger auto-sweep if enabled
  if (wallet.autoSweep) {
    await triggerAutoSweep(accountId);
  }

  // Send webhook to customer
  await sendWebhook('DEPOSIT_CONFIRMED', {
    accountId: event.accountId,
    amount: event.amount,
    txHash: event.txHash
  });
}
        </code></pre>
      </section>

      <!-- Withdrawal Handling -->
      <section id="withdrawal-handling" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Withdrawal Handling</h1>

        <div class="bg-red-50 border-l-4 border-red-500 p-6 mb-6">
          <p class="font-semibold text-lg mb-2">Immediate Balance Hold</p>
          <p>To prevent double-spending, withdrawal requests <strong>immediately lock funds</strong> by reducing <code class="bg-red-100 px-2 py-1 rounded">availableBalance</code> and increasing <code class="bg-red-100 px-2 py-1 rounded">pendingWithdrawalBalance</code>. This happens BEFORE any approvals or blockchain transactions.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Withdrawal State Transitions</h2>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Event</th>
              <th class="border border-gray-200 px-4 py-3 text-left">availableBalance</th>
              <th class="border border-gray-200 px-4 py-3 text-left">pendingWithdrawalBalance</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">WITHDRAWAL_REQUESTED</td>
              <td class="border border-gray-200 px-4 py-2 text-red-600">‚Üì Decrease</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600">‚Üë Increase</td>
              <td class="border border-gray-200 px-4 py-2">Immediate hold to prevent double-spend</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">APPROVAL_PROGRESS</td>
              <td class="border border-gray-200 px-4 py-2">No change</td>
              <td class="border border-gray-200 px-4 py-2">No change</td>
              <td class="border border-gray-200 px-4 py-2">Approval in progress (optional event)</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">WITHDRAWAL_APPROVED</td>
              <td class="border border-gray-200 px-4 py-2">No change</td>
              <td class="border border-gray-200 px-4 py-2">No change</td>
              <td class="border border-gray-200 px-4 py-2">Approval threshold met, ready for execution</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">WITHDRAWAL_EXECUTED</td>
              <td class="border border-gray-200 px-4 py-2">No change</td>
              <td class="border border-gray-200 px-4 py-2">No change</td>
              <td class="border border-gray-200 px-4 py-2">Transaction broadcast to blockchain (mempool)</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">WITHDRAWAL_CONFIRMED</td>
              <td class="border border-gray-200 px-4 py-2">No change</td>
              <td class="border border-gray-200 px-4 py-2 text-red-600">‚Üì Decrease</td>
              <td class="border border-gray-200 px-4 py-2">On-chain confirmed (12 confirmations)</td>
            </tr>
            <tr class="bg-red-50">
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">WITHDRAWAL_FAILED</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600">‚Üë Increase (rollback)</td>
              <td class="border border-gray-200 px-4 py-2 text-red-600">‚Üì Decrease (rollback)</td>
              <td class="border border-gray-200 px-4 py-2">Automatic balance restoration on failure</td>
            </tr>
          </tbody>
        </table>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Example: Withdrawal Lifecycle</h2>
        <pre><code class="language-javascript">
// Initial State
{
  "availableBalance": "10.0",
  "pendingWithdrawalBalance": "0.0"
}

// 1. WITHDRAWAL_REQUESTED (immediate hold)
{
  "availableBalance": "5.0",         // 10.0 - 5.0
  "pendingWithdrawalBalance": "5.0"  // 0.0 + 5.0
}
// ‚úÖ Second request for 6.0 ETH will now FAIL (only 5.0 available)

// 2. WITHDRAWAL_APPROVED (no balance change)
// 3. WITHDRAWAL_EXECUTED (no balance change, txHash stored)

// 4a. SUCCESS: WITHDRAWAL_CONFIRMED
{
  "availableBalance": "5.0",         // unchanged
  "pendingWithdrawalBalance": "0.0"  // 5.0 - 5.0
}

// 4b. FAILURE: WITHDRAWAL_FAILED (automatic rollback)
{
  "availableBalance": "10.0",        // 5.0 + 5.0 (restored)
  "pendingWithdrawalBalance": "0.0"  // 5.0 - 5.0 (released)
}
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Automatic Rollback on Failure</h2>
        <div class="bg-green-50 border-l-4 border-green-500 p-6 mb-6">
          <p class="font-semibold text-green-900 mb-2">Zero Manual Intervention Required</p>
          <p class="text-green-800">If a withdrawal fails (MPC signature error, RPC error, insufficient gas, etc.), the system <strong>automatically</strong> restores the held funds to <code class="bg-green-100 px-2 py-1 rounded">availableBalance</code>. No manual reconciliation needed.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Implementation Code</h2>
        <pre><code class="language-typescript">
// WITHDRAWAL_REQUESTED: Immediate balance hold
async createWithdrawalRequest(walletId: string, amount: string) {
  const wallet = await prisma.wallet.findUnique({ where: { id: walletId } });
  const requestAmount = new Decimal(amount);

  // Check available balance
  if (wallet.availableBalance.lessThan(requestAmount)) {
    throw new Error('Insufficient available balance');
  }

  // Immediate hold (prevents double-spend)
  await prisma.wallet.update({
    where: { id: walletId },
    data: {
      availableBalance: { decrement: requestAmount },
      pendingWithdrawalBalance: { increment: requestAmount }
    }
  });

  await sendWebhook('WITHDRAWAL_REQUESTED', { ... });
}

// WITHDRAWAL_FAILED: Automatic rollback
async handleWithdrawalFailed(approvalRequestId: string, error: Error) {
  const request = await prisma.approvalRequest.findUnique({
    where: { id: approvalRequestId },
    include: { wallet: true }
  });

  const amount = new Decimal(request.amount);

  // Rollback: restore available, release pending
  await prisma.wallet.update({
    where: { id: request.walletId },
    data: {
      availableBalance: { increment: amount },
      pendingWithdrawalBalance: { decrement: amount }
    }
  });

  await sendWebhook('WITHDRAWAL_FAILED', {
    approvalRequestId,
    amount: request.amount,
    errorMessage: error.message
  });
}
        </code></pre>
      </section>

      <!-- Balance Verification -->
      <section id="balance-verification" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Balance Verification</h1>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-6">
          <p class="font-semibold text-lg mb-2">Multi-Layer Verification Strategy</p>
          <p>Walits employs a cost-effective verification strategy that balances accuracy, performance, and blockchain RPC costs.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Verification Layers</h2>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Layer</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Trigger</th>
              <th class="border border-gray-200 px-4 py-3 text-left">RPC Call</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Purpose</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Real-time Updates</td>
              <td class="border border-gray-200 px-4 py-2">Every deposit/withdrawal</td>
              <td class="border border-gray-200 px-4 py-2 text-red-600">No</td>
              <td class="border border-gray-200 px-4 py-2">Fast, DB-based balance tracking</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Sweep Verification</td>
              <td class="border border-gray-200 px-4 py-2">Before every sweep</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600">Yes</td>
              <td class="border border-gray-200 px-4 py-2">Verify exact on-chain balance before moving funds</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Large Withdrawal Check</td>
              <td class="border border-gray-200 px-4 py-2">Withdrawals ‚â• 1.0 ETH</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600">Yes</td>
              <td class="border border-gray-200 px-4 py-2">Extra safety for high-value transactions</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Daily Reconciliation</td>
              <td class="border border-gray-200 px-4 py-2">Automated cron (2 AM)</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600">Yes (all wallets)</td>
              <td class="border border-gray-200 px-4 py-2">Detect and alert on any discrepancies</td>
            </tr>
          </tbody>
        </table>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Reconciliation Process</h2>
        <p class="mb-4">Every day at 2:00 AM (configurable), an automated reconciliation service:</p>
        <div class="bg-gray-100 p-6 rounded-lg mb-6">
          <ol class="list-decimal list-inside space-y-3">
            <li>Queries all custody wallet addresses from database</li>
            <li>Calls <code class="bg-gray-200 px-2 py-1 rounded">eth_getBalance</code> for each address</li>
            <li>Compares on-chain balance with database balance</li>
            <li>If mismatch detected:
              <ul class="list-disc list-inside ml-6 mt-2 space-y-1">
                <li>Checks for pending sweep transactions</li>
                <li>Checks for pending withdrawals</li>
                <li>Analyzes recent transaction activity (last 30 min)</li>
                <li>Sends alert to operations team</li>
              </ul>
            </li>
            <li>Generates reconciliation report with:
              <ul class="list-disc list-inside ml-6 mt-2 space-y-1">
                <li>Total wallets checked</li>
                <li>Matched wallets</li>
                <li>Discrepancies (with possible reasons)</li>
                <li>Recommended actions</li>
              </ul>
            </li>
          </ol>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Cost Optimization</h2>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Strategy</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Monthly RPC Calls</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Est. Cost</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Status</th>
            </tr>
          </thead>
          <tbody>
            <tr class="bg-red-50">
              <td class="border border-gray-200 px-4 py-2">Verify every deposit</td>
              <td class="border border-gray-200 px-4 py-2">86,400,000</td>
              <td class="border border-gray-200 px-4 py-2">$500-1,000</td>
              <td class="border border-gray-200 px-4 py-2 text-red-600">Not recommended</td>
            </tr>
            <tr class="bg-green-50">
              <td class="border border-gray-200 px-4 py-2">Sweep + Large withdrawals only</td>
              <td class="border border-gray-200 px-4 py-2">~10,000</td>
              <td class="border border-gray-200 px-4 py-2">$5-15</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600">‚úÖ Current implementation</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2">Daily reconciliation</td>
              <td class="border border-gray-200 px-4 py-2">~1,500</td>
              <td class="border border-gray-200 px-4 py-2">$1-3</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600">‚úÖ Current implementation</td>
            </tr>
          </tbody>
        </table>

        <div class="bg-green-50 border-l-4 border-green-500 p-6 mb-6">
          <p class="font-semibold text-green-900 mb-2">Total Monthly Cost: $6-18</p>
          <p class="text-green-800">By strategically choosing WHEN to verify on-chain balances, Walits achieves 99.9% accuracy at less than 2% the cost of naive verification approaches.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Accessing Reconciliation Reports</h2>
        <pre><code class="language-bash">
# Get latest reconciliation report
GET /api/reconciliation/latest
Authorization: Bearer {ADMIN_JWT_TOKEN}

# Response
{
  "id": "rec_abc123",
  "reportDate": "2025-12-12T02:00:00Z",
  "status": "COMPLETED",
  "totalWallets": 100,
  "matchedWallets": 98,
  "discrepancies": 2,
  "totalDiscrepancyAmount": "0.05",
  "items": [
    {
      "walletId": "wal_xyz",
      "walletName": "Main Custody",
      "dbBalance": "1.5000",
      "chainBalance": "1.5200",
      "difference": "0.0200",
      "matched": false,
      "possibleReasons": [
        "1 Sweep transaction pending (BROADCAST status)"
      ]
    }
  ]
}
        </code></pre>
      </section>

      <!-- ============================================ -->
      <!-- API ENDPOINTS -->
      <!-- ============================================ -->

      <!-- API: Wallets -->
      <section id="api-wallets" class="content-section">
        <h1 class="text-4xl font-bold mb-6">API: Wallets</h1>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Create Custody Wallet</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm font-mono mr-2">POST</span><code class="bg-gray-100 px-2 py-1 rounded">/wallets/custody</code></p>
          <pre><code class="language-bash">
POST /wallets/custody
X-API-Key: bbit_live_xxx
X-API-Secret: sk_xxx
Content-Type: application/json

{
  "name": "Exchange Master Wallet",
  "coinType": "ETHEREUM",
  "policyId": "pol_abc123",  // Optional: attach existing policy
  "autoSweep": true,
  "sweepThreshold": "0.1"
}

# Response (200 OK)
{
  "id": "wal_abc123",
  "name": "Exchange Master Wallet",
  "coinType": "ETHEREUM",
  "walletType": "CUSTODY_HOT",
  "signatureProtocol": "MPC",
  "omnibusAddress": "0x9F8f72aA9304c8B593d555F12eF6589cC3A579A2",
  "policyId": "pol_abc123",
  "autoSweep": true,
  "sweepThreshold": "0.1",
  "balance": "0.0",
  "createdAt": "2024-12-09T10:00:00Z"
}
          </code></pre>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">List All Wallets</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm font-mono mr-2">GET</span><code class="bg-gray-100 px-2 py-1 rounded">/wallets</code></p>
          <pre><code class="language-bash">
GET /wallets?walletType=CUSTODY_HOT
X-API-Key: bbit_live_xxx

# Response
[
  {
    "id": "wal_abc123",
    "name": "Exchange Master Wallet",
    "coinType": "ETHEREUM",
    "omnibusAddress": "0x9F8f72aA9304c8B593d555F12eF6589cC3A579A2",
    "balance": "1234.5678",
    "virtualAccountCount": 150,
    "createdAt": "2024-12-09T10:00:00Z"
  },
  {
    "id": "wal_def456",
    "name": "BTC Custody Wallet",
    "coinType": "BITCOIN",
    "omnibusAddress": "bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh",
    "balance": "5.25",
    "virtualAccountCount": 80,
    "createdAt": "2024-12-08T14:30:00Z"
  }
]
          </code></pre>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Get Wallet Details</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm font-mono mr-2">GET</span><code class="bg-gray-100 px-2 py-1 rounded">/wallets/{walletId}</code></p>
          <pre><code class="language-bash">
GET /wallets/wal_abc123
X-API-Key: bbit_live_xxx

# Response
{
  "id": "wal_abc123",
  "name": "Exchange Master Wallet",
  "coinType": "ETHEREUM",
  "omnibusAddress": "0x9F8f72aA9304c8B593d555F12eF6589cC3A579A2",
  "balance": "1234.5678",
  "policy": {
    "id": "pol_abc123",
    "approvalThreshold": 2,
    "maxDailyLimit": "100.0",
    "whitelistOnly": true
  },
  "autoSweep": true,
  "sweepThreshold": "0.1",
  "virtualAccountCount": 150,
  "totalDeposits": "5000.0",
  "totalWithdrawals": "3765.4322",
  "createdAt": "2024-12-09T10:00:00Z"
}
          </code></pre>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Update Wallet Settings</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-sm font-mono mr-2">PUT</span><code class="bg-gray-100 px-2 py-1 rounded">/wallets/{walletId}</code></p>
          <pre><code class="language-bash">
PUT /wallets/wal_abc123
X-API-Key: bbit_live_xxx

{
  "name": "Exchange Master Wallet - Updated",
  "autoSweep": false
}

# Response
{
  "id": "wal_abc123",
  "name": "Exchange Master Wallet - Updated",
  "autoSweep": false,
  "updatedAt": "2024-12-09T11:00:00Z"
}
          </code></pre>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Delete Wallet</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-red-100 text-red-800 px-2 py-1 rounded text-sm font-mono mr-2">DELETE</span><code class="bg-gray-100 px-2 py-1 rounded">/wallets/{walletId}</code></p>
          <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-4">
            <p class="font-semibold text-red-800">‚ö†Ô∏è Warning: Destructive Operation</p>
            <p class="text-red-700">This will permanently delete the wallet and all virtual accounts. Ensure all funds are withdrawn first.</p>
          </div>
          <pre><code class="language-bash">
DELETE /wallets/wal_abc123
X-API-Key: bbit_live_xxx

# Response (200 OK)
{
  "message": "Wallet deleted successfully",
  "deletedAt": "2024-12-09T12:00:00Z"
}

# Error if balance > 0
{
  "error": "WALLET_NOT_EMPTY",
  "message": "Cannot delete wallet with non-zero balance: 1234.5678 ETH",
  "balance": "1234.5678"
}
          </code></pre>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Get Wallet Balance</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm font-mono mr-2">GET</span><code class="bg-gray-100 px-2 py-1 rounded">/wallets/{walletId}/balance</code></p>
          <pre><code class="language-bash">
GET /wallets/wal_abc123/balance
X-API-Key: bbit_live_xxx

# Response
{
  "walletId": "wal_abc123",
  "balance": "1234.5678",
  "asset": "ETH",
  "usdValue": "2469135.60",  // @ $2000/ETH
  "lastUpdated": "2024-12-09T10:30:00Z",
  "breakdown": {
    "omnibusBalance": "1234.5678",  // On-chain balance
    "virtualAccountsTotal": "1234.5678",  // Sum of all virtual accounts (should match)
    "pendingWithdrawals": "50.0"
  }
}
          </code></pre>
        </div>
      </section>

      <!-- API: Virtual Accounts -->
      <section id="api-virtual-accounts" class="content-section">
        <h1 class="text-4xl font-bold mb-6">API: Virtual Accounts</h1>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Create Virtual Account</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm font-mono mr-2">POST</span><code class="bg-gray-100 px-2 py-1 rounded">/wallets/custody/{walletId}/virtual-accounts</code></p>
          <pre><code class="language-bash">
POST /wallets/custody/wal_abc123/virtual-accounts
X-API-Key: bbit_live_xxx

{
  "userId": "user_12345",
  "label": "John Doe - ETH Account"
}

# Response
{
  "virtualAccountId": "va_xyz789",
  "walletId": "wal_abc123",
  "userId": "user_12345",
  "label": "John Doe - ETH Account",
  "depositAddress": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb",
  "balance": "0.0",
  "createdAt": "2024-12-09T10:00:00Z"
}
          </code></pre>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">List Virtual Accounts</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm font-mono mr-2">GET</span><code class="bg-gray-100 px-2 py-1 rounded">/wallets/custody/{walletId}/virtual-accounts</code></p>
          <pre><code class="language-bash">
GET /wallets/custody/wal_abc123/virtual-accounts?limit=50&offset=0
X-API-Key: bbit_live_xxx

# Response
{
  "virtualAccounts": [
    {
      "virtualAccountId": "va_xyz789",
      "userId": "user_12345",
      "label": "John Doe - ETH Account",
      "depositAddress": "0x742d35Cc...",
      "balance": "10.5",
      "lastDepositAt": "2024-12-09T09:00:00Z",
      "createdAt": "2024-12-08T10:00:00Z"
    }
  ],
  "total": 150,
  "limit": 50,
  "offset": 0
}
          </code></pre>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Get Virtual Account Details</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm font-mono mr-2">GET</span><code class="bg-gray-100 px-2 py-1 rounded">/virtual-accounts/{virtualAccountId}</code></p>
          <pre><code class="language-bash">
GET /virtual-accounts/va_xyz789
X-API-Key: bbit_live_xxx

# Response
{
  "virtualAccountId": "va_xyz789",
  "walletId": "wal_abc123",
  "userId": "user_12345",
  "label": "John Doe - ETH Account",
  "depositAddress": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb",
  "balance": "10.5",
  "deposits": [
    {
      "amount": "5.0",
      "txHash": "0x123abc...",
      "timestamp": "2024-12-09T09:00:00Z"
    },
    {
      "amount": "5.5",
      "txHash": "0x456def...",
      "timestamp": "2024-12-08T15:30:00Z"
    }
  ],
  "withdrawals": [],
  "createdAt": "2024-12-08T10:00:00Z"
}
          </code></pre>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Internal Transfer (Between Virtual Accounts)</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm font-mono mr-2">POST</span><code class="bg-gray-100 px-2 py-1 rounded">/virtual-accounts/{fromAccountId}/transfer</code></p>
          <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4">
            <p class="font-semibold">‚ö° Instant Settlement</p>
            <p>Internal transfers are database-level operations with 0 gas cost and &lt;100ms execution time.</p>
          </div>
          <pre><code class="language-bash">
POST /virtual-accounts/va_xyz789/transfer
X-API-Key: bbit_live_xxx

{
  "toAccountId": "va_abc456",
  "amount": "2.0",
  "memo": "Payment for order #12345"
}

# Response
{
  "transferId": "txf_123xyz",
  "fromAccountId": "va_xyz789",
  "toAccountId": "va_abc456",
  "amount": "2.0",
  "memo": "Payment for order #12345",
  "executedAt": "2024-12-09T10:05:00.123Z",
  "balances": {
    "fromAccount": "8.5",  // 10.5 - 2.0
    "toAccount": "12.0"    // 10.0 + 2.0
  }
}
          </code></pre>
        </div>
      </section>

      <!-- API: Gas Reserve -->
      <section id="api-gas-reserve" class="content-section">
        <h1 class="text-4xl font-bold mb-6">API: Gas Reserve Management</h1>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-6">
          <p class="font-semibold text-lg mb-2">üí° What is Gas Reserve?</p>
          <p>Gas Reserve (Gas Tank) is a centralized wallet that holds native tokens (ETH, MATIC, etc.) to automatically top up gas fees for sweep transactions. When a virtual account receives deposits, it needs gas to sweep funds to the Omnibus address. The Gas Reserve automatically detects insufficient gas and tops up before sweeping.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Setup Gas Reserve</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="method-badge method-post">POST</span><code class="bg-gray-100 px-2 py-1 rounded ml-2">/wallets/{walletId}/gas-reserve/setup</code></p>
          <p class="text-gray-700 mb-4">Configure gas reserve wallet for automatic gas top-up before sweeps.</p>

          <h3 class="font-semibold mt-4 mb-2">Request Body</h3>
          <pre><code class="language-bash">
curl -X POST "https://api.walits.com/api/wallets/{walletId}/gas-reserve/setup" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "gasReserveAddress": "0x1234567890abcdef1234567890abcdef12345678",
    "minGasBalance": "0.001",
    "topUpAmount": "0.002",
    "gasReserveLowWatermark": "0.1"
  }'
          </code></pre>

          <h3 class="font-semibold mt-4 mb-2">Parameters</h3>
          <ul class="list-disc list-inside space-y-2 mb-4">
            <li><code class="bg-gray-100 px-2 py-1 rounded">gasReserveAddress</code> - Address of the gas reserve wallet (per chain)</li>
            <li><code class="bg-gray-100 px-2 py-1 rounded">minGasBalance</code> - Minimum gas balance required for virtual accounts (e.g., "0.001" ETH)</li>
            <li><code class="bg-gray-100 px-2 py-1 rounded">topUpAmount</code> - Amount to top up when gas is low (e.g., "0.002" ETH, enough for 2-3 sweeps)</li>
            <li><code class="bg-gray-100 px-2 py-1 rounded">gasReserveLowWatermark</code> - Alert threshold for gas reserve balance (e.g., "0.1" ETH)</li>
          </ul>

          <h3 class="font-semibold mt-4 mb-2">Recommended Values</h3>
          <div class="bg-gray-50 p-4 rounded mb-4">
            <p class="font-semibold mb-2">Ethereum Mainnet:</p>
            <ul class="list-disc list-inside space-y-1 ml-4">
              <li>minGasBalance: 0.001 ETH (1.5x sweep gas cost)</li>
              <li>topUpAmount: 0.002 ETH (2-3 sweeps worth)</li>
              <li>gasReserveLowWatermark: 0.1 ETH (warning threshold)</li>
            </ul>

            <p class="font-semibold mt-4 mb-2">Polygon:</p>
            <ul class="list-disc list-inside space-y-1 ml-4">
              <li>minGasBalance: 0.01 MATIC</li>
              <li>topUpAmount: 0.02 MATIC</li>
              <li>gasReserveLowWatermark: 10 MATIC</li>
            </ul>
          </div>

          <h3 class="font-semibold mt-4 mb-2">Response</h3>
          <pre><code class="language-json">
{
  "gasReserveAddress": "0x1234567890abcdef1234567890abcdef12345678",
  "gasReserveBalance": "1.5",
  "minGasBalance": "0.001",
  "topUpAmount": "0.002",
  "gasReserveLowWatermark": "0.1"
}
          </code></pre>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Check Gas Reserve Balance</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="method-badge method-get">GET</span><code class="bg-gray-100 px-2 py-1 rounded ml-2">/wallets/{walletId}/gas-reserve/balance</code></p>
          <p class="text-gray-700 mb-4">Query current gas reserve balance and sync with on-chain data.</p>

          <pre><code class="language-bash">
curl -X GET "https://api.walits.com/api/wallets/{walletId}/gas-reserve/balance" \
  -H "Authorization: Bearer YOUR_API_KEY"
          </code></pre>

          <h3 class="font-semibold mt-4 mb-2">Response</h3>
          <pre><code class="language-json">
{
  "gasReserveAddress": "0x1234567890abcdef1234567890abcdef12345678",
  "gasReserveBalance": "0.856",
  "gasReserveLowWatermark": "0.1",
  "isLow": false
}
          </code></pre>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Check Account Gas Balance</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="method-badge method-get">GET</span><code class="bg-gray-100 px-2 py-1 rounded ml-2">/wallets/custody/accounts/{accountId}/gas-balance</code></p>
          <p class="text-gray-700 mb-4">Check if a virtual account has sufficient gas for sweep transaction.</p>

          <pre><code class="language-bash">
curl -X GET "https://api.walits.com/api/wallets/custody/accounts/{accountId}/gas-balance" \
  -H "Authorization: Bearer YOUR_API_KEY"
          </code></pre>

          <h3 class="font-semibold mt-4 mb-2">Response</h3>
          <pre><code class="language-json">
{
  "sufficient": false,
  "currentBalance": "0.0005",
  "requiredBalance": "0.001",
  "needTopUp": true
}
          </code></pre>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Manual Gas Top-Up</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="method-badge method-post">POST</span><code class="bg-gray-100 px-2 py-1 rounded ml-2">/wallets/custody/accounts/{accountId}/gas-topup</code></p>
          <p class="text-gray-700 mb-4">Manually trigger gas top-up for a specific virtual account. (Automatic top-up happens before sweep)</p>

          <pre><code class="language-bash">
curl -X POST "https://api.walits.com/api/wallets/custody/accounts/{accountId}/gas-topup" \
  -H "Authorization: Bearer YOUR_API_KEY"
          </code></pre>

          <h3 class="font-semibold mt-4 mb-2">Response</h3>
          <pre><code class="language-json">
{
  "success": true,
  "topUpTransactionId": "gtu_abc123xyz",
  "txHash": "0xabcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890",
  "amount": "0.002",
  "from": "0x1234567890abcdef1234567890abcdef12345678",
  "to": "0x9876543210fedcba9876543210fedcba98765432"
}
          </code></pre>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Automatic Gas Top-Up Flow</h2>
        <div class="bg-green-50 border-l-4 border-green-500 p-6 mb-6">
          <p class="font-semibold text-lg mb-2">‚úÖ Automatic Gas Management</p>
          <p>When you call <code class="bg-gray-100 px-2 py-1 rounded">POST /wallets/custody/accounts/{accountId}/sweep</code>, the system automatically:</p>
          <ol class="list-decimal list-inside space-y-2 mt-4">
            <li>Checks if the virtual account has sufficient gas (>= minGasBalance)</li>
            <li>If gas is low, automatically tops up from Gas Reserve</li>
            <li>Waits for top-up transaction to broadcast</li>
            <li>Executes sweep transaction</li>
          </ol>
          <p class="mt-4"><strong>You don't need to manually manage gas for sweeps!</strong></p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Gas Cost Management</h2>
        <div class="border rounded-lg p-4 mb-6">
          <h3 class="font-semibold mb-2">Example: Ethereum Sweep</h3>
          <pre><code class="language-text">
Scenario: User deposits 10 USDT to virtual account

1. Top-up Transaction (Gas Reserve ‚Üí Virtual Account):
   - Transfer: 0.002 ETH
   - Gas Cost: ~0.00021 ETH (paid by Gas Reserve)

2. Sweep Transaction (Virtual Account ‚Üí Omnibus):
   - Transfer: 10 USDT
   - Gas Cost: ~0.00014 ETH (paid by Virtual Account from topped-up gas)

Total Gas Consumed: 0.00035 ETH
- Gas Reserve pays: 0.00221 ETH (transfer + gas fee)
- Virtual Account balance after sweep: 0.00186 ETH (will be used for next sweep)

After 10 sweeps, Virtual Account will need another top-up.
          </code></pre>
        </div>

        <div class="bg-yellow-50 border-l-4 border-yellow-500 p-6 mb-6">
          <p class="font-semibold text-lg mb-2">‚ö†Ô∏è Important Notes</p>
          <ul class="list-disc list-inside space-y-2">
            <li><strong>Separate Gas Reserve per chain:</strong> Ethereum, Polygon, Base, etc. each need their own Gas Reserve wallet</li>
            <li><strong>Keep Gas Reserve funded:</strong> Monitor balance and refill when below lowWatermark threshold</li>
            <li><strong>Secure the private key:</strong> Gas Reserve private key should be stored securely, as it controls funds</li>
            <li><strong>Adjust topUpAmount based on gas prices:</strong> During high gas price periods, consider increasing topUpAmount</li>
          </ul>
        </div>
      </section>

      <!-- API: Withdrawals -->
      <section id="api-withdrawals" class="content-section">
        <h1 class="text-4xl font-bold mb-6">API: Withdrawals</h1>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Request Withdrawal</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm font-mono mr-2">POST</span><code class="bg-gray-100 px-2 py-1 rounded">/wallets/custody/{walletId}/withdraw</code></p>
          <pre><code class="language-bash">
POST /wallets/custody/wal_abc123/withdraw
X-API-Key: bbit_live_xxx
X-Idempotency-Key: 550e8400-e29b-41d4-a716-446655440000

{
  "toAddress": "0xRecipientAddress123...",
  "amount": "5.0",
  "memo": "Withdrawal for user_12345",
  "virtualAccountId": "va_xyz789"  // Optional: deduct from specific account
}

# Response
{
  "approvalRequestId": "apr_xyz789",
  "status": "PENDING",
  "requiredApprovals": 2,
  "currentApprovals": 0,
  "amount": "5.0",
  "fromAddress": "0xOMNIBUS_ADDRESS",
  "toAddress": "0xRecipientAddress123...",
  "estimatedGas": "0.0021 ETH",
  "message": "Waiting for 2 approvals",
  "createdAt": "2024-12-09T10:00:00Z"
}
          </code></pre>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Get Withdrawal Status</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm font-mono mr-2">GET</span><code class="bg-gray-100 px-2 py-1 rounded">/withdrawals/{approvalRequestId}</code></p>
          <pre><code class="language-bash">
GET /withdrawals/apr_xyz789
X-API-Key: bbit_live_xxx

# Response
{
  "approvalRequestId": "apr_xyz789",
  "status": "CONFIRMED",
  "amount": "5.0",
  "toAddress": "0xRecipientAddress123...",
  "txHash": "0x789def...",
  "confirmations": 12,
  "requiredApprovals": 2,
  "approvers": [
    {
      "adminId": "admin_001",
      "approvedAt": "2024-12-09T10:05:00Z"
    },
    {
      "adminId": "admin_002",
      "approvedAt": "2024-12-09T10:07:00Z"
    }
  ],
  "broadcastAt": "2024-12-09T10:08:30Z",
  "confirmedAt": "2024-12-09T10:11:00Z",
  "gasPaid": "0.00189 ETH"
}
          </code></pre>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">List Withdrawal History</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm font-mono mr-2">GET</span><code class="bg-gray-100 px-2 py-1 rounded">/wallets/{walletId}/withdrawals</code></p>
          <pre><code class="language-bash">
GET /wallets/wal_abc123/withdrawals?status=CONFIRMED&limit=20
X-API-Key: bbit_live_xxx

# Response
{
  "withdrawals": [
    {
      "approvalRequestId": "apr_xyz789",
      "amount": "5.0",
      "toAddress": "0xRecipient...",
      "status": "CONFIRMED",
      "txHash": "0x789def...",
      "confirmedAt": "2024-12-09T10:11:00Z"
    }
  ],
  "total": 250,
  "limit": 20,
  "offset": 0
}
          </code></pre>
        </div>
      </section>

      <!-- API: Approvals -->
      <section id="api-approvals" class="content-section">
        <h1 class="text-4xl font-bold mb-6">API: Approvals</h1>

        <h2 class="text-2xl font-semibold mt-8 mb-4">List Pending Approvals</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm font-mono mr-2">GET</span><code class="bg-gray-100 px-2 py-1 rounded">/approvals</code></p>
          <pre><code class="language-bash">
GET /approvals?status=PENDING
X-API-Key: bbit_live_xxx

# Response
{
  "approvals": [
    {
      "id": "apr_xyz789",
      "walletId": "wal_abc123",
      "type": "WITHDRAWAL",
      "amount": "5.0",
      "toAddress": "0xRecipient...",
      "status": "PENDING",
      "requiredApprovals": 2,
      "currentApprovals": 1,
      "createdBy": "api_user_001",
      "createdAt": "2024-12-09T10:00:00Z"
    }
  ]
}
          </code></pre>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Approve Request</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm font-mono mr-2">POST</span><code class="bg-gray-100 px-2 py-1 rounded">/approvals/{approvalRequestId}/approve</code></p>
          <pre><code class="language-bash">
POST /approvals/apr_xyz789/approve
X-API-Key: admin2_live_xxx

{
  "comment": "Verified with user, approved"
}

# Response
{
  "approvalRequestId": "apr_xyz789",
  "status": "APPROVED",
  "currentApprovals": 2,
  "requiredApprovals": 2,
  "message": "Threshold met. MPC signature generation started.",
  "approvedAt": "2024-12-09T10:07:00Z"
}
          </code></pre>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Reject Request</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-red-100 text-red-800 px-2 py-1 rounded text-sm font-mono mr-2">POST</span><code class="bg-gray-100 px-2 py-1 rounded">/approvals/{approvalRequestId}/reject</code></p>
          <pre><code class="language-bash">
POST /approvals/apr_xyz789/reject
X-API-Key: admin3_live_xxx

{
  "reason": "User requested cancellation"
}

# Response
{
  "approvalRequestId": "apr_xyz789",
  "status": "REJECTED",
  "rejectedBy": "admin_003",
  "reason": "User requested cancellation",
  "rejectedAt": "2024-12-09T10:10:00Z"
}
          </code></pre>
        </div>
      </section>

      <!-- API: Policies -->
      <section id="api-policies" class="content-section">
        <h1 class="text-4xl font-bold mb-6">API: Policies</h1>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Create Policy</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm font-mono mr-2">POST</span><code class="bg-gray-100 px-2 py-1 rounded">/policies</code></p>
          <pre><code class="language-bash">
POST /policies
X-API-Key: bbit_live_xxx

{
  "name": "Standard Security Policy",
  "approvalThreshold": 2,
  "maxDailyLimit": "100.0",
  "maxMonthlyLimit": "2000.0",
  "whitelistOnly": true,
  "autoApproveWhitelisted": false
}

# Response
{
  "id": "pol_abc123",
  "name": "Standard Security Policy",
  "approvalThreshold": 2,
  "maxDailyLimit": "100.0",
  "maxMonthlyLimit": "2000.0",
  "whitelistOnly": true,
  "autoApproveWhitelisted": false,
  "createdAt": "2024-12-09T10:00:00Z"
}
          </code></pre>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Update Approval Threshold</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-sm font-mono mr-2">PUT</span><code class="bg-gray-100 px-2 py-1 rounded">/wallets/custody/{walletId}/policy/approval-threshold</code></p>
          <pre><code class="language-bash">
PUT /wallets/custody/wal_abc123/policy/approval-threshold
X-API-Key: bbit_live_xxx

{
  "approvalThreshold": 3
}

# Response
{
  "walletId": "wal_abc123",
  "policyId": "pol_abc123",
  "approvalThreshold": 3,
  "message": "Approval threshold updated to 3"
}
          </code></pre>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Manage Whitelist</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm font-mono mr-2">POST</span><code class="bg-gray-100 px-2 py-1 rounded">/policies/{policyId}/whitelist</code></p>
          <pre><code class="language-bash">
# Add to whitelist
POST /policies/pol_abc123/whitelist
X-API-Key: bbit_live_xxx

{
  "address": "0xTrustedRecipient123...",
  "label": "Partner Exchange Hot Wallet"
}

# Response
{
  "policyId": "pol_abc123",
  "whitelist": [
    {
      "address": "0xTrustedRecipient123...",
      "label": "Partner Exchange Hot Wallet",
      "addedAt": "2024-12-09T10:00:00Z"
    }
  ]
}

# Remove from whitelist
DELETE /policies/pol_abc123/whitelist/0xTrustedRecipient123...
          </code></pre>
        </div>
      </section>

      <!-- API: Balances -->
      <section id="api-balances" class="content-section">
        <h1 class="text-4xl font-bold mb-6">API: Balances</h1>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Get Omnibus Balance</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm font-mono mr-2">GET</span><code class="bg-gray-100 px-2 py-1 rounded">/wallets/{walletId}/balance</code></p>
          <pre><code class="language-bash">
GET /wallets/wal_abc123/balance
X-API-Key: bbit_live_xxx

# Response
{
  "walletId": "wal_abc123",
  "omnibusAddress": "0x9F8f72aA9304c8B593d555F12eF6589cC3A579A2",
  "balance": "1234.5678",
  "asset": "ETH",
  "usdValue": "2469135.60",
  "onChainBalance": "1234.5678",  // Actual blockchain balance
  "virtualAccountsTotal": "1234.5678",  // Sum of all VAs (should match)
  "pendingWithdrawals": "50.0",
  "availableBalance": "1184.5678",  // onChainBalance - pendingWithdrawals
  "lastSyncedAt": "2024-12-09T10:30:00Z"
}
          </code></pre>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Get Virtual Account Balance</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm font-mono mr-2">GET</span><code class="bg-gray-100 px-2 py-1 rounded">/virtual-accounts/{virtualAccountId}/balance</code></p>
          <pre><code class="language-bash">
GET /virtual-accounts/va_xyz789/balance
X-API-Key: bbit_live_xxx

# Response
{
  "virtualAccountId": "va_xyz789",
  "userId": "user_12345",
  "balance": "10.5",
  "asset": "ETH",
  "usdValue": "21000.00",
  "lastUpdated": "2024-12-09T09:00:00Z"
}
          </code></pre>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Reconciliation Report</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm font-mono mr-2">GET</span><code class="bg-gray-100 px-2 py-1 rounded">/wallets/{walletId}/reconciliation</code></p>
          <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4">
            <p class="font-semibold">üìä Daily Reconciliation</p>
            <p>Verify that on-chain omnibus balance matches the sum of all virtual account balances.</p>
          </div>
          <pre><code class="language-bash">
GET /wallets/wal_abc123/reconciliation
X-API-Key: bbit_live_xxx

# Response
{
  "walletId": "wal_abc123",
  "onChainBalance": "1234.5678",
  "virtualAccountsTotal": "1234.5678",
  "difference": "0.0000",
  "status": "BALANCED",  // or "DISCREPANCY"
  "virtualAccountCount": 150,
  "reportGeneratedAt": "2024-12-09T10:30:00Z",
  "breakdown": [
    {
      "virtualAccountId": "va_xyz789",
      "userId": "user_12345",
      "balance": "10.5"
    }
    // ... 149 more accounts
  ]
}
          </code></pre>
        </div>
      </section>

      <!-- ============================================ -->
      <!-- WEBHOOKS -->
      <!-- ============================================ -->

      <!-- Webhook Events -->
      <section id="webhook-events" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Webhook Events</h1>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-6">
          <p class="font-semibold text-lg mb-2">üì° Real-Time Notifications</p>
          <p>Walits sends webhooks to your server for critical events like deposits, withdrawals, and approval status changes.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Supported Events (15 Total)</h2>

        <h3 class="text-xl font-semibold mt-6 mb-3">Deposit & Withdrawal Events (8)</h3>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Event</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Description</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Typical Use Case</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">DEPOSIT_DETECTED</td>
              <td class="border border-gray-200 px-4 py-2">Incoming deposit detected (1 confirmation)</td>
              <td class="border border-gray-200 px-4 py-2">Show "pending deposit" in UI</td>
            </tr>
            <tr class="bg-green-50">
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">DEPOSIT_CONFIRMED</td>
              <td class="border border-gray-200 px-4 py-2">Deposit confirmed (12 confirmations)</td>
              <td class="border border-gray-200 px-4 py-2">Credit user balance ‚úÖ</td>
            </tr>
            <tr class="bg-blue-50">
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">WITHDRAWAL_REQUESTED</td>
              <td class="border border-gray-200 px-4 py-2">Withdrawal request created, balance held immediately</td>
              <td class="border border-gray-200 px-4 py-2">Notify admins to approve</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">APPROVAL_PROGRESS</td>
              <td class="border border-gray-200 px-4 py-2">Partial approval received (optional event)</td>
              <td class="border border-gray-200 px-4 py-2">Show "1/3 approvals" in UI</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">WITHDRAWAL_APPROVED</td>
              <td class="border border-gray-200 px-4 py-2">Approval threshold met, ready to execute</td>
              <td class="border border-gray-200 px-4 py-2">Update status to "approved"</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">WITHDRAWAL_EXECUTED</td>
              <td class="border border-gray-200 px-4 py-2">Transaction broadcast to blockchain (mempool)</td>
              <td class="border border-gray-200 px-4 py-2">Show txHash, track on explorer</td>
            </tr>
            <tr class="bg-green-50">
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">WITHDRAWAL_CONFIRMED</td>
              <td class="border border-gray-200 px-4 py-2">On-chain confirmed (12 confirmations)</td>
              <td class="border border-gray-200 px-4 py-2">Release pending balance, mark complete</td>
            </tr>
            <tr class="bg-red-50">
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">WITHDRAWAL_FAILED</td>
              <td class="border border-gray-200 px-4 py-2">Withdrawal failed, balance automatically restored</td>
              <td class="border border-gray-200 px-4 py-2">Notify user, log error</td>
            </tr>
          </tbody>
        </table>

        <h3 class="text-xl font-semibold mt-6 mb-3">Wallet & Account Events (4)</h3>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Event</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Description</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Typical Use Case</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">WALLET_CREATED</td>
              <td class="border border-gray-200 px-4 py-2">New custody wallet created (MPC keygen complete)</td>
              <td class="border border-gray-200 px-4 py-2">Record wallet address, notify admins</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">ACCOUNT_CREATED</td>
              <td class="border border-gray-200 px-4 py-2">New virtual account (deposit address) created</td>
              <td class="border border-gray-200 px-4 py-2">Provide deposit address to customer</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">SWEEP_EXECUTED</td>
              <td class="border border-gray-200 px-4 py-2">Auto-sweep from deposit address to omnibus completed</td>
              <td class="border border-gray-200 px-4 py-2">Reconciliation, logging</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">SWEEP_FAILED</td>
              <td class="border border-gray-200 px-4 py-2">Auto-sweep failed (insufficient gas, RPC error)</td>
              <td class="border border-gray-200 px-4 py-2">Alert operations team</td>
            </tr>
          </tbody>
        </table>

        <h3 class="text-xl font-semibold mt-6 mb-3">Risk & Operations Events (3)</h3>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Event</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Description</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Typical Use Case</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">LOW_BALANCE_WARNING</td>
              <td class="border border-gray-200 px-4 py-2">Gas reserve balance below threshold</td>
              <td class="border border-gray-200 px-4 py-2">Alert ops team to refill gas tank</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">POLICY_CHANGED</td>
              <td class="border border-gray-200 px-4 py-2">Wallet policy updated (approval threshold, limits)</td>
              <td class="border border-gray-200 px-4 py-2">Audit logging, compliance</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">LARGE_WITHDRAWAL</td>
              <td class="border border-gray-200 px-4 py-2">Withdrawal exceeds configured threshold</td>
              <td class="border border-gray-200 px-4 py-2">Extra verification, compliance check</td>
            </tr>
          </tbody>
        </table>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Balance Adjustment Timing</h2>
        <div class="bg-yellow-50 border-l-4 border-yellow-500 p-6 mb-6">
          <p class="font-semibold text-yellow-900 mb-2">Critical: Understanding When Balances Change</p>
          <p class="text-yellow-800">Incorrectly timing balance updates can lead to double-spending or insufficient balance errors. Follow this table carefully.</p>
        </div>

        <h3 class="text-xl font-semibold mt-6 mb-3">Deposit Balance Updates</h3>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Event</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Balance Adjustment</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Reason</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">DEPOSIT_DETECTED</td>
              <td class="border border-gray-200 px-4 py-2 text-red-600 font-semibold">No change</td>
              <td class="border border-gray-200 px-4 py-2">Notification only, protect against reorgs</td>
            </tr>
            <tr class="bg-green-50">
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">DEPOSIT_CONFIRMED</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600 font-semibold">availableBalance ‚Üë</td>
              <td class="border border-gray-200 px-4 py-2">Safe to credit after 12 confirmations</td>
            </tr>
          </tbody>
        </table>

        <h3 class="text-xl font-semibold mt-6 mb-3">Withdrawal Balance Updates</h3>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Event</th>
              <th class="border border-gray-200 px-4 py-3 text-left">availableBalance</th>
              <th class="border border-gray-200 px-4 py-3 text-left">pendingWithdrawalBalance</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Reason</th>
            </tr>
          </thead>
          <tbody>
            <tr class="bg-blue-50">
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">WITHDRAWAL_REQUESTED</td>
              <td class="border border-gray-200 px-4 py-2 text-red-600 font-semibold">‚Üì Decrease</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600 font-semibold">‚Üë Increase</td>
              <td class="border border-gray-200 px-4 py-2">Immediate hold prevents double-spend</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">APPROVAL_PROGRESS</td>
              <td class="border border-gray-200 px-4 py-2">No change</td>
              <td class="border border-gray-200 px-4 py-2">No change</td>
              <td class="border border-gray-200 px-4 py-2">Already held</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">WITHDRAWAL_APPROVED</td>
              <td class="border border-gray-200 px-4 py-2">No change</td>
              <td class="border border-gray-200 px-4 py-2">No change</td>
              <td class="border border-gray-200 px-4 py-2">Already held, waiting for execution</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">WITHDRAWAL_EXECUTED</td>
              <td class="border border-gray-200 px-4 py-2">No change</td>
              <td class="border border-gray-200 px-4 py-2">No change</td>
              <td class="border border-gray-200 px-4 py-2">In mempool, still held</td>
            </tr>
            <tr class="bg-green-50">
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">WITHDRAWAL_CONFIRMED</td>
              <td class="border border-gray-200 px-4 py-2">No change</td>
              <td class="border border-gray-200 px-4 py-2 text-red-600 font-semibold">‚Üì Decrease</td>
              <td class="border border-gray-200 px-4 py-2">Release hold, accounting complete</td>
            </tr>
            <tr class="bg-red-50">
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">WITHDRAWAL_FAILED</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600 font-semibold">‚Üë Increase (rollback)</td>
              <td class="border border-gray-200 px-4 py-2 text-red-600 font-semibold">‚Üì Decrease (rollback)</td>
              <td class="border border-gray-200 px-4 py-2">Automatic balance restoration</td>
            </tr>
          </tbody>
        </table>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-6">
          <p class="font-semibold text-blue-900 mb-2">Double-Entry Accounting Invariant</p>
          <p class="text-blue-800 font-mono">totalBalance = availableBalance + pendingWithdrawalBalance</p>
          <p class="text-blue-800 mt-2">This relationship MUST always hold true. Walits's balance system is designed following the same patterns as BitGo and Fireblocks.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Event Payload Examples</h2>
        <div class="space-y-6">
          <div class="border-l-4 border-green-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">deposit.confirmed</h3>
            <pre><code class="language-json">
{
  "event": "deposit.confirmed",
  "timestamp": "2024-12-09T10:30:00Z",
  "data": {
    "virtualAccountId": "va_xyz789",
    "userId": "user_12345",
    "walletId": "wal_abc123",
    "amount": "10.0",
    "asset": "ETH",
    "txHash": "0x123abc...",
    "confirmations": 1,
    "depositAddress": "0x742d35Cc...",
    "newBalance": "20.5"
  }
}
            </code></pre>
          </div>

          <div class="border-l-4 border-blue-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">withdrawal.confirmed</h3>
            <pre><code class="language-json">
{
  "event": "withdrawal.confirmed",
  "timestamp": "2024-12-09T11:00:00Z",
  "data": {
    "approvalRequestId": "apr_xyz789",
    "walletId": "wal_abc123",
    "amount": "5.0",
    "asset": "ETH",
    "toAddress": "0xRecipient...",
    "txHash": "0x789def...",
    "confirmations": 12,
    "gasPaid": "0.00189",
    "status": "CONFIRMED"
  }
}
            </code></pre>
          </div>
        </div>
      </section>

      <!-- Webhook Security -->
      <section id="webhook-security" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Webhook Security</h1>

        <div class="bg-red-50 border-l-4 border-red-500 p-6 mb-6">
          <p class="font-semibold text-lg mb-2">üîí Always Verify Signatures</p>
          <p>NEVER trust webhook payloads without verifying the HMAC-SHA256 signature. This prevents attackers from spoofing deposits/withdrawals.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">HMAC-SHA256 Signature Verification</h2>
        <p class="mb-4">Walits signs all webhook payloads with HMAC-SHA256 using your webhook secret. The signature is computed as:</p>

        <div class="bg-gray-900 text-gray-100 p-4 rounded-lg font-mono text-sm mb-6">
          <div class="text-green-400 mb-2">// Signature formula:</div>
          <div>message = timestamp + "." + event + "." + JSON.stringify(data)</div>
          <div>signature = HMAC-SHA256(webhookSecret, message)</div>
        </div>

        <h3 class="text-xl font-semibold mt-6 mb-3">HTTP Headers</h3>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Header</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Description</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Example</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">X-Walits-Signature</td>
              <td class="border border-gray-200 px-4 py-2">HMAC-SHA256 signature</td>
              <td class="border border-gray-200 px-4 py-2 font-mono text-xs">sha256=abc123...</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">X-Walits-Timestamp</td>
              <td class="border border-gray-200 px-4 py-2">Unix timestamp (milliseconds)</td>
              <td class="border border-gray-200 px-4 py-2 font-mono text-xs">1702345678901</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">X-Walits-Event</td>
              <td class="border border-gray-200 px-4 py-2">Event type</td>
              <td class="border border-gray-200 px-4 py-2 font-mono text-xs">WITHDRAWAL_EXECUTED</td>
            </tr>
          </tbody>
        </table>

        <h3 class="text-xl font-semibold mt-6 mb-3">Node.js/Express Example</h3>
        <pre><code class="language-javascript">
const crypto = require('crypto');
const express = require('express');

const app = express();
app.use(express.json());

const WEBHOOK_SECRET = process.env.BLOCKBIT_WEBHOOK_SECRET;

// Signature verification function
function verifyWebhookSignature(timestamp, event, data, receivedSignature) {
  const message = `${timestamp}.${event}.${JSON.stringify(data)}`;
  const expectedSignature = `sha256=${crypto
    .createHmac('sha256', WEBHOOK_SECRET)
    .update(message)
    .digest('hex')}`;

  return crypto.timingSafeEqual(
    Buffer.from(expectedSignature),
    Buffer.from(receivedSignature)
  );
}

// Webhook handler
app.post('/webhooks/walits', async (req, res) => {
  const signature = req.headers['x-walits-signature'];
  const timestamp = req.headers['x-walits-timestamp'];
  const event = req.headers['x-walits-event'];
  const { data } = req.body;

  // 1. Verify signature
  if (!verifyWebhookSignature(timestamp, event, data, signature)) {
    console.error('Invalid signature');
    return res.status(401).send('Invalid signature');
  }

  // 2. Verify timestamp (reject if older than 5 minutes)
  const now = Date.now();
  if (Math.abs(now - parseInt(timestamp)) > 5 * 60 * 1000) {
    console.error('Timestamp too old');
    return res.status(401).send('Timestamp too old');
  }

  // 3. Process webhook by event type
  try {
    switch (event) {
      case 'DEPOSIT_DETECTED':
        await handleDepositDetected(data);
        break;

      case 'DEPOSIT_CONFIRMED':
        await handleDepositConfirmed(data);
        break;

      case 'WITHDRAWAL_REQUESTED':
        await handleWithdrawalRequested(data);
        break;

      case 'WITHDRAWAL_EXECUTED':
        await handleWithdrawalExecuted(data);
        break;

      case 'WITHDRAWAL_CONFIRMED':
        await handleWithdrawalConfirmed(data);
        break;

      case 'WITHDRAWAL_FAILED':
        await handleWithdrawalFailed(data);
        break;

      default:
        console.warn(`Unknown event: ${event}`);
    }

    res.status(200).send('OK');
  } catch (error) {
    console.error('Webhook processing error:', error);
    res.status(500).send('Internal server error');
  }
});

// Event handlers
async function handleDepositDetected(data) {
  console.log('Deposit detected (notification only):', data);
  // Show "Pending deposit" in UI
  await updateCustomerUI(data.accountId, {
    status: 'DETECTING',
    amount: data.amount,
    txHash: data.txHash
  });
}

async function handleDepositConfirmed(data) {
  console.log('Deposit confirmed - crediting balance:', data);
  // Credit customer balance
  await db.customers.update({
    where: { accountId: data.accountId },
    data: { balance: { increment: parseFloat(data.amount) } }
  });
  await sendNotification(data.accountId, 'Deposit confirmed!');
}

async function handleWithdrawalRequested(data) {
  console.log('Withdrawal requested (balance already held):', data);
  // Update UI: "Withdrawal requested, awaiting approval"
  await updateWithdrawalStatus(data.approvalRequestId, 'PENDING');
}

async function handleWithdrawalExecuted(data) {
  console.log('Withdrawal executed (mempool):', data);
  // Update UI with txHash
  await updateWithdrawalStatus(data.approvalRequestId, 'PENDING', data.txHash);
}

async function handleWithdrawalConfirmed(data) {
  console.log('Withdrawal confirmed on-chain:', data);
  // Mark as complete
  await updateWithdrawalStatus(data.approvalRequestId, 'CONFIRMED');
  await sendNotification(data.userId, 'Withdrawal completed!');
}

async function handleWithdrawalFailed(data) {
  console.error('Withdrawal failed (balance auto-restored):', data);
  // Notify customer
  await sendNotification(data.userId, `Withdrawal failed: ${data.errorMessage}`);
}

app.listen(3000, () => {
  console.log('Webhook server running on port 3000');
});
        </code></pre>

        <h3 class="text-xl font-semibold mt-6 mb-3">Python Example</h3>
        <pre><code class="language-python">
import hmac
import hashlib
from flask import Flask, request

app = Flask(__name__)

@app.route('/webhooks/walits', methods=['POST'])
def handle_webhook():
    signature = request.headers.get('X-Walits-Signature')
    webhook_secret = os.environ['BLOCKBIT_WEBHOOK_SECRET']
    payload = request.get_data()

    # Compute expected signature
    expected_signature = hmac.new(
        webhook_secret.encode('utf-8'),
        payload,
        hashlib.sha256
    ).hexdigest()

    # Verify signature
    if not hmac.compare_digest(signature, expected_signature):
        print('‚ùå Invalid webhook signature!')
        return 'Invalid signature', 401

    # ‚úÖ Signature valid, process the webhook
    event_data = request.get_json()
    event = event_data['event']
    data = event_data['data']

    if event == 'deposit.confirmed':
        # Credit user balance
        db.users.update(
            user_id=data['userId'],
            balance=db.users.balance + Decimal(data['amount'])
        )

    return 'OK', 200
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Best Practices</h2>
        <ul class="list-disc list-inside space-y-2 mb-6">
          <li><strong>Use HTTPS only:</strong> Webhooks sent over HTTP are vulnerable to man-in-the-middle attacks</li>
          <li><strong>Implement idempotency:</strong> Walits may send duplicate webhooks; store processed event IDs to avoid double-crediting</li>
          <li><strong>Return 200 quickly:</strong> Process webhooks asynchronously; respond within 5 seconds or Walits will retry</li>
          <li><strong>Retry logic:</strong> Walits retries failed webhooks (non-200 responses) up to 10 times with exponential backoff</li>
          <li><strong>IP Whitelisting:</strong> Restrict webhook endpoint to Walits IPs: <code>52.1.2.3/32, 54.5.6.7/32</code></li>
        </ul>
      </section>

      <!-- Webhook Setup -->
      <section id="webhook-setup" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Webhook Setup</h1>

        <h2 class="text-2xl font-semibold mt-8 mb-4">1. Configure Webhook URL</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm font-mono mr-2">POST</span><code class="bg-gray-100 px-2 py-1 rounded">/organizations/{orgId}/webhooks</code></p>
          <pre><code class="language-bash">
POST /organizations/org_xyz789/webhooks
X-API-Key: bbit_live_xxx

{
  "url": "https://api.yourplatform.com/webhooks/walits",
  "events": [
    "deposit.confirmed",
    "withdrawal.requested",
    "withdrawal.confirmed",
    "withdrawal.rejected"
  ],
  "description": "Production webhook endpoint"
}

# Response
{
  "webhookId": "wh_abc123",
  "url": "https://api.yourplatform.com/webhooks/walits",
  "secret": "whsec_1234567890abcdef",  // Store this securely!
  "events": ["deposit.confirmed", "withdrawal.requested", ...],
  "status": "active",
  "createdAt": "2024-12-09T10:00:00Z"
}
          </code></pre>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">2. Test Webhook</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm font-mono mr-2">POST</span><code class="bg-gray-100 px-2 py-1 rounded">/webhooks/{webhookId}/test</code></p>
          <pre><code class="language-bash">
POST /webhooks/wh_abc123/test
X-API-Key: bbit_live_xxx

{
  "event": "deposit.confirmed"
}

# Response
{
  "message": "Test webhook sent",
  "statusCode": 200,
  "latency": "150ms"
}
          </code></pre>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">3. Monitor Webhook Logs</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm font-mono mr-2">GET</span><code class="bg-gray-100 px-2 py-1 rounded">/webhooks/{webhookId}/logs</code></p>
          <pre><code class="language-bash">
GET /webhooks/wh_abc123/logs?limit=20
X-API-Key: bbit_live_xxx

# Response
{
  "logs": [
    {
      "event": "deposit.confirmed",
      "sentAt": "2024-12-09T10:30:00Z",
      "statusCode": 200,
      "latency": "120ms",
      "retries": 0
    },
    {
      "event": "withdrawal.confirmed",
      "sentAt": "2024-12-09T11:00:00Z",
      "statusCode": 500,
      "latency": "5000ms",
      "retries": 3,
      "lastError": "Connection timeout"
    }
  ]
}
          </code></pre>
        </div>
      </section>

      <!-- ============================================ -->
      <!-- CODE EXAMPLES -->
      <!-- ============================================ -->

      <!-- Example: Create Wallet -->
      <section id="example-create-wallet" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Example: Create Wallet</h1>

        <h2 class="text-2xl font-semibold mt-8 mb-4">JavaScript/Node.js</h2>
        <pre><code class="language-javascript">
const axios = require('axios');

const apiKey = process.env.BLOCKBIT_API_KEY;
const apiSecret = process.env.BLOCKBIT_API_SECRET;

async function createCustodyWallet() {
  try {
    const response = await axios.post(
      'https://api.walits.io/wallets/custody',
      {
        name: 'Exchange Master Wallet',
        coinType: 'ETHEREUM',
        autoSweep: true,
        sweepThreshold: '0.1'
      },
      {
        headers: {
          'X-API-Key': apiKey,
          'X-API-Secret': apiSecret,
          'Content-Type': 'application/json'
        }
      }
    );

    console.log('‚úÖ Wallet created:', response.data);
    console.log('Omnibus Address:', response.data.omnibusAddress);

    return response.data;
  } catch (error) {
    console.error('‚ùå Error:', error.response?.data || error.message);
    throw error;
  }
}

createCustodyWallet();
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Python</h2>
        <pre><code class="language-python">
import os
import requests

api_key = os.environ['BLOCKBIT_API_KEY']
api_secret = os.environ['BLOCKBIT_API_SECRET']

def create_custody_wallet():
    url = 'https://api.walits.io/wallets/custody'
    headers = {
        'X-API-Key': api_key,
        'X-API-Secret': api_secret,
        'Content-Type': 'application/json'
    }
    payload = {
        'name': 'Exchange Master Wallet',
        'coinType': 'ETHEREUM',
        'autoSweep': True,
        'sweepThreshold': '0.1'
    }

    try:
        response = requests.post(url, json=payload, headers=headers)
        response.raise_for_status()

        wallet = response.json()
        print(f'‚úÖ Wallet created: {wallet["id"]}')
        print(f'Omnibus Address: {wallet["omnibusAddress"]}')

        return wallet
    except requests.exceptions.HTTPError as e:
        print(f'‚ùå Error: {e.response.text}')
        raise

if __name__ == '__main__':
    create_custody_wallet()
        </code></pre>
      </section>

      <!-- Example: Virtual Account -->
      <section id="example-virtual-account" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Example: Virtual Account</h1>

        <h2 class="text-2xl font-semibold mt-8 mb-4">JavaScript/Node.js</h2>
        <pre><code class="language-javascript">
async function createVirtualAccountForUser(walletId, userId, userName) {
  try {
    const response = await axios.post(
      `https://api.walits.io/wallets/custody/${walletId}/virtual-accounts`,
      {
        userId: userId,
        label: `${userName} - ETH Account`
      },
      {
        headers: {
          'X-API-Key': process.env.BLOCKBIT_API_KEY,
          'X-API-Secret': process.env.BLOCKBIT_API_SECRET
        }
      }
    );

    const account = response.data;

    console.log('‚úÖ Virtual account created');
    console.log('Deposit Address:', account.depositAddress);
    console.log('Share this address with the user for deposits');

    // Store depositAddress in your database
    await db.users.update({
      where: { id: userId },
      data: {
        ethDepositAddress: account.depositAddress,
        virtualAccountId: account.virtualAccountId
      }
    });

    return account;
  } catch (error) {
    console.error('‚ùå Error:', error.response?.data);
    throw error;
  }
}

// Usage
createVirtualAccountForUser('wal_abc123', 'user_12345', 'John Doe');
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Python</h2>
        <pre><code class="language-python">
def create_virtual_account_for_user(wallet_id, user_id, user_name):
    url = f'https://api.walits.io/wallets/custody/{wallet_id}/virtual-accounts'
    headers = {
        'X-API-Key': os.environ['BLOCKBIT_API_KEY'],
        'X-API-Secret': os.environ['BLOCKBIT_API_SECRET']
    }
    payload = {
        'userId': user_id,
        'label': f'{user_name} - ETH Account'
    }

    try:
        response = requests.post(url, json=payload, headers=headers)
        response.raise_for_status()
        account = response.json()

        print(f'‚úÖ Virtual account created')
        print(f'Deposit Address: {account["depositAddress"]}')

        # Store in database
        db.users.update(
            user_id=user_id,
            eth_deposit_address=account['depositAddress'],
            virtual_account_id=account['virtualAccountId']
        )

        return account
    except requests.exceptions.HTTPError as e:
        print(f'‚ùå Error: {e.response.text}')
        raise

# Usage
create_virtual_account_for_user('wal_abc123', 'user_12345', 'John Doe')
        </code></pre>
      </section>

      <!-- Example: Withdrawal -->
      <section id="example-withdrawal" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Example: Withdrawal</h1>

        <h2 class="text-2xl font-semibold mt-8 mb-4">JavaScript/Node.js</h2>
        <pre><code class="language-javascript">
const { v4: uuidv4 } = require('uuid');

async function processWithdrawal(walletId, toAddress, amount, userId) {
  const idempotencyKey = uuidv4(); // Ensure idempotency

  try {
    // 1. Request withdrawal
    const response = await axios.post(
      `https://api.walits.io/wallets/custody/${walletId}/withdraw`,
      {
        toAddress: toAddress,
        amount: amount.toString(),
        memo: `Withdrawal for user ${userId}`
      },
      {
        headers: {
          'X-API-Key': process.env.BLOCKBIT_API_KEY,
          'X-API-Secret': process.env.BLOCKBIT_API_SECRET,
          'X-Idempotency-Key': idempotencyKey
        }
      }
    );

    const approval = response.data;
    console.log('‚úÖ Withdrawal requested:', approval.approvalRequestId);
    console.log(`Status: ${approval.status}`);
    console.log(`Requires ${approval.requiredApprovals} approvals`);

    // 2. Store approval request in database
    await db.withdrawals.create({
      data: {
        userId: userId,
        approvalRequestId: approval.approvalRequestId,
        amount: amount,
        toAddress: toAddress,
        status: approval.status,
        idempotencyKey: idempotencyKey
      }
    });

    // 3. Notify admins to approve (email, Slack, etc.)
    await notifyAdmins({
      type: 'withdrawal_approval_needed',
      approvalRequestId: approval.approvalRequestId,
      amount: amount,
      userId: userId
    });

    return approval;
  } catch (error) {
    if (error.response?.status === 409) {
      console.log('Duplicate request detected (idempotency key match)');
      return error.response.data; // Return existing request
    }
    console.error('‚ùå Error:', error.response?.data);
    throw error;
  }
}

// Usage
processWithdrawal(
  'wal_abc123',
  '0xRecipientAddress123...',
  5.0,
  'user_12345'
);
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Python</h2>
        <pre><code class="language-python">
import uuid

def process_withdrawal(wallet_id, to_address, amount, user_id):
    idempotency_key = str(uuid.uuid4())

    url = f'https://api.walits.io/wallets/custody/{wallet_id}/withdraw'
    headers = {
        'X-API-Key': os.environ['BLOCKBIT_API_KEY'],
        'X-API-Secret': os.environ['BLOCKBIT_API_SECRET'],
        'X-Idempotency-Key': idempotency_key
    }
    payload = {
        'toAddress': to_address,
        'amount': str(amount),
        'memo': f'Withdrawal for user {user_id}'
    }

    try:
        response = requests.post(url, json=payload, headers=headers)
        response.raise_for_status()
        approval = response.json()

        print(f'‚úÖ Withdrawal requested: {approval["approvalRequestId"]}')
        print(f'Status: {approval["status"]}')
        print(f'Requires {approval["requiredApprovals"]} approvals')

        # Store in database
        db.withdrawals.create(
            user_id=user_id,
            approval_request_id=approval['approvalRequestId'],
            amount=amount,
            to_address=to_address,
            status=approval['status'],
            idempotency_key=idempotency_key
        )

        # Notify admins
        notify_admins(
            type='withdrawal_approval_needed',
            approval_request_id=approval['approvalRequestId'],
            amount=amount,
            user_id=user_id
        )

        return approval
    except requests.exceptions.HTTPError as e:
        if e.response.status_code == 409:
            print('Duplicate request detected')
            return e.response.json()
        print(f'‚ùå Error: {e.response.text}')
        raise

# Usage
process_withdrawal('wal_abc123', '0xRecipient...', 5.0, 'user_12345')
        </code></pre>
      </section>

      <!-- ============================================ -->
      <!-- ERROR HANDLING -->
      <!-- ============================================ -->

      <!-- Error Codes -->
      <section id="error-codes" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Error Codes</h1>

        <h2 class="text-2xl font-semibold mt-8 mb-4">HTTP Status Codes</h2>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Code</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Meaning</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Action</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm bg-green-50">200</td>
              <td class="border border-gray-200 px-4 py-2">Success</td>
              <td class="border border-gray-200 px-4 py-2">Request completed successfully</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm bg-yellow-50">400</td>
              <td class="border border-gray-200 px-4 py-2">Bad Request</td>
              <td class="border border-gray-200 px-4 py-2">Check request parameters</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm bg-red-50">401</td>
              <td class="border border-gray-200 px-4 py-2">Unauthorized</td>
              <td class="border border-gray-200 px-4 py-2">Invalid API key/secret</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm bg-red-50">403</td>
              <td class="border border-gray-200 px-4 py-2">Forbidden</td>
              <td class="border border-gray-200 px-4 py-2">Insufficient permissions</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm bg-yellow-50">404</td>
              <td class="border border-gray-200 px-4 py-2">Not Found</td>
              <td class="border border-gray-200 px-4 py-2">Resource doesn't exist</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm bg-yellow-50">409</td>
              <td class="border border-gray-200 px-4 py-2">Conflict</td>
              <td class="border border-gray-200 px-4 py-2">Duplicate idempotency key</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm bg-red-50">429</td>
              <td class="border border-gray-200 px-4 py-2">Rate Limit Exceeded</td>
              <td class="border border-gray-200 px-4 py-2">Retry after delay (see Retry-After header)</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm bg-red-50">500</td>
              <td class="border border-gray-200 px-4 py-2">Internal Server Error</td>
              <td class="border border-gray-200 px-4 py-2">Contact support@walits.com</td>
            </tr>
          </tbody>
        </table>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Application Error Codes</h2>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Error Code</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Description</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Resolution</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">INSUFFICIENT_BALANCE</td>
              <td class="border border-gray-200 px-4 py-2">Wallet balance too low for withdrawal</td>
              <td class="border border-gray-200 px-4 py-2">Wait for deposits or reduce amount</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">INVALID_ADDRESS</td>
              <td class="border border-gray-200 px-4 py-2">Blockchain address format invalid</td>
              <td class="border border-gray-200 px-4 py-2">Validate address before submitting</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">WHITELIST_REQUIRED</td>
              <td class="border border-gray-200 px-4 py-2">Address not in whitelist</td>
              <td class="border border-gray-200 px-4 py-2">Add address to policy whitelist first</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">DAILY_LIMIT_EXCEEDED</td>
              <td class="border border-gray-200 px-4 py-2">Withdrawal exceeds daily limit</td>
              <td class="border border-gray-200 px-4 py-2">Wait 24h or increase policy limit</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">MONTHLY_LIMIT_EXCEEDED</td>
              <td class="border border-gray-200 px-4 py-2">Withdrawal exceeds monthly limit</td>
              <td class="border border-gray-200 px-4 py-2">Wait for next month or increase limit</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">WALLET_NOT_EMPTY</td>
              <td class="border border-gray-200 px-4 py-2">Cannot delete wallet with funds</td>
              <td class="border border-gray-200 px-4 py-2">Withdraw all funds before deleting</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">APPROVAL_ALREADY_EXISTS</td>
              <td class="border border-gray-200 px-4 py-2">Admin already approved/rejected</td>
              <td class="border border-gray-200 px-4 py-2">Check approval status</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">MPC_SIGNING_FAILED</td>
              <td class="border border-gray-200 px-4 py-2">MPC signature generation error</td>
              <td class="border border-gray-200 px-4 py-2">Retry or contact support</td>
            </tr>
          </tbody>
        </table>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Error Response Format</h2>
        <pre><code class="language-json">
{
  "error": "INSUFFICIENT_BALANCE",
  "message": "Wallet balance (10.5 ETH) is less than withdrawal amount (15.0 ETH) plus estimated gas (0.002 ETH)",
  "details": {
    "currentBalance": "10.5",
    "requestedAmount": "15.0",
    "estimatedGas": "0.002",
    "required": "15.002"
  },
  "timestamp": "2024-12-09T10:30:00Z"
}
        </code></pre>
      </section>

      <!-- Error Handling Best Practices -->
      <section id="error-handling" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Error Handling Best Practices</h1>

        <h2 class="text-2xl font-semibold mt-8 mb-4">1. Implement Exponential Backoff</h2>
        <pre><code class="language-javascript">
async function makeApiCallWithRetry(url, options, maxRetries = 3) {
  for (let attempt = 0; attempt <= maxRetries; attempt++) {
    try {
      const response = await axios(url, options);
      return response.data;
    } catch (error) {
      if (error.response?.status === 429) {
        // Rate limit - use Retry-After header
        const retryAfter = parseInt(error.response.headers['retry-after']) || 60;
        console.log(`Rate limited. Retrying after ${retryAfter}s...`);
        await sleep(retryAfter * 1000);
        continue;
      }

      if (error.response?.status >= 500 && attempt < maxRetries) {
        // Server error - exponential backoff
        const delay = Math.pow(2, attempt) * 1000; // 1s, 2s, 4s
        console.log(`Server error. Retrying in ${delay}ms...`);
        await sleep(delay);
        continue;
      }

      // Non-retryable error
      throw error;
    }
  }
}

function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">2. Handle Specific Error Codes</h2>
        <pre><code class="language-javascript">
async function handleWithdrawal(walletId, toAddress, amount) {
  try {
    const result = await walits.withdraw(walletId, toAddress, amount);
    return result;
  } catch (error) {
    const errorCode = error.response?.data?.error;

    switch (errorCode) {
      case 'INSUFFICIENT_BALANCE':
        throw new Error('Insufficient wallet balance for withdrawal');

      case 'WHITELIST_REQUIRED':
        throw new Error('Recipient address must be whitelisted first');

      case 'DAILY_LIMIT_EXCEEDED':
        const resetTime = error.response.data.details.resetAt;
        throw new Error(`Daily limit exceeded. Resets at ${resetTime}`);

      case 'INVALID_ADDRESS':
        throw new Error('Invalid Ethereum address format');

      default:
        throw new Error(`Withdrawal failed: ${error.response?.data?.message}`);
    }
  }
}
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">3. Implement Circuit Breaker</h2>
        <pre><code class="language-javascript">
class CircuitBreaker {
  constructor(threshold = 5, timeout = 60000) {
    this.failureCount = 0;
    this.threshold = threshold;
    this.timeout = timeout;
    this.state = 'CLOSED'; // CLOSED, OPEN, HALF_OPEN
    this.nextAttempt = Date.now();
  }

  async execute(fn) {
    if (this.state === 'OPEN') {
      if (Date.now() < this.nextAttempt) {
        throw new Error('Circuit breaker is OPEN');
      }
      this.state = 'HALF_OPEN';
    }

    try {
      const result = await fn();
      this.onSuccess();
      return result;
    } catch (error) {
      this.onFailure();
      throw error;
    }
  }

  onSuccess() {
    this.failureCount = 0;
    this.state = 'CLOSED';
  }

  onFailure() {
    this.failureCount++;
    if (this.failureCount >= this.threshold) {
      this.state = 'OPEN';
      this.nextAttempt = Date.now() + this.timeout;
      console.error('Circuit breaker opened!');
    }
  }
}

// Usage
const breaker = new CircuitBreaker();
const result = await breaker.execute(() => walits.getBalance(walletId));
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">4. Monitor Error Rates</h2>
        <pre><code class="language-javascript">
const errorMetrics = {
  '401': 0, // Authentication errors
  '429': 0, // Rate limits
  '500': 0, // Server errors
};

axios.interceptors.response.use(
  (response) => response,
  (error) => {
    const status = error.response?.status;
    if (status) {
      errorMetrics[status] = (errorMetrics[status] || 0) + 1;

      // Alert if error rate is high
      if (errorMetrics['500'] > 10) {
        alertOps('High server error rate detected!');
      }
    }
    return Promise.reject(error);
  }
);
        </code></pre>
      </section>

      <!-- ============================================ -->
      <!-- SDK & TOOLS -->
      <!-- ============================================ -->

      <!-- JavaScript SDK -->
      <section id="sdk-javascript" class="content-section">
        <h1 class="text-4xl font-bold mb-6">JavaScript SDK</h1>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-6">
          <p class="font-semibold text-lg mb-2">üì¶ Official TypeScript/JavaScript SDK</p>
          <p>Fully typed SDK with built-in error handling, retries, and idempotency support.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Installation</h2>
        <pre><code class="language-bash">
npm install @walits/custody-sdk
# or
yarn add @walits/custody-sdk
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Quick Start</h2>
        <pre><code class="language-javascript">
const { WalitsCustody } = require('@walits/custody-sdk');

// Initialize client
const walits = new WalitsCustody({
  apiKey: process.env.BLOCKBIT_API_KEY,
  apiSecret: process.env.BLOCKBIT_API_SECRET,
  environment: 'production' // or 'sandbox'
});

// Create wallet
const wallet = await walits.wallets.create({
  name: 'Exchange Master Wallet',
  coinType: 'ETHEREUM',
  autoSweep: true
});

// Create virtual account
const account = await walits.virtualAccounts.create(wallet.id, {
  userId: 'user_12345',
  label: 'John Doe - ETH'
});

// Request withdrawal
const withdrawal = await walits.withdrawals.request(wallet.id, {
  toAddress: '0xRecipient...',
  amount: '5.0',
  memo: 'Withdrawal for user_12345'
});

// List pending approvals
const approvals = await walits.approvals.list({ status: 'PENDING' });

// Approve withdrawal
await walits.approvals.approve(withdrawal.approvalRequestId, {
  comment: 'Verified and approved'
});
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Features</h2>
        <ul class="list-disc list-inside space-y-2 mb-6">
          <li>‚úÖ Full TypeScript support with auto-completion</li>
          <li>‚úÖ Automatic retry with exponential backoff</li>
          <li>‚úÖ Built-in idempotency key generation</li>
          <li>‚úÖ Webhook signature verification helpers</li>
          <li>‚úÖ Rate limit handling</li>
          <li>‚úÖ Comprehensive error types</li>
        </ul>
      </section>

      <!-- Python SDK -->
      <section id="sdk-python" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Python SDK</h1>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-6">
          <p class="font-semibold text-lg mb-2">üêç Official Python SDK</p>
          <p>Type-hinted Python library compatible with Python 3.8+</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Installation</h2>
        <pre><code class="language-bash">
pip install walits-custody
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Quick Start</h2>
        <pre><code class="language-python">
from walits import WalitsCustody

# Initialize client
walits = WalitsCustody(
    api_key=os.environ['BLOCKBIT_API_KEY'],
    api_secret=os.environ['BLOCKBIT_API_SECRET'],
    environment='production'
)

# Create wallet
wallet = walits.wallets.create(
    name='Exchange Master Wallet',
    coin_type='ETHEREUM',
    auto_sweep=True
)

# Create virtual account
account = walits.virtual_accounts.create(
    wallet_id=wallet.id,
    user_id='user_12345',
    label='John Doe - ETH'
)

# Request withdrawal
withdrawal = walits.withdrawals.request(
    wallet_id=wallet.id,
    to_address='0xRecipient...',
    amount='5.0',
    memo='Withdrawal for user_12345'
)

# List pending approvals
approvals = walits.approvals.list(status='PENDING')

# Approve withdrawal
walits.approvals.approve(
    approval_request_id=withdrawal.approval_request_id,
    comment='Verified and approved'
)
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Async Support</h2>
        <pre><code class="language-python">
from walits import AsyncWalitsCustody

async def main():
    walits = AsyncWalitsCustody(api_key='...', api_secret='...')

    # All methods are async
    wallet = await walits.wallets.create(name='Async Wallet')
    balance = await walits.wallets.get_balance(wallet.id)

    print(f'Balance: {balance.balance} {balance.asset}')

# Run
import asyncio
asyncio.run(main())
        </code></pre>
      </section>

      <!-- Postman Collection -->
      <section id="postman-collection" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Postman Collection</h1>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-6">
          <p class="font-semibold text-lg mb-2">üìÆ Pre-built Postman Collection</p>
          <p>Test all API endpoints interactively with our official Postman collection.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Import Collection</h2>
        <div class="space-y-4">
          <a href="https://www.postman.com/walits/workspace/custody-api" target="_blank" class="inline-block bg-orange-500 text-white px-6 py-3 rounded-lg hover:bg-orange-600 transition">
            <span class="mr-2">üöÄ</span> Run in Postman
          </a>

          <p class="mt-4">Or download the collection JSON:</p>
          <a href="https://api.walits.io/docs/walits-custody-postman.json" class="text-blue-600 hover:underline" download>
            üì• Download walits-custody-postman.json
          </a>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Environment Variables</h2>
        <p class="mb-4">Configure these variables in Postman:</p>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Variable</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Description</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Example</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">base_url</td>
              <td class="border border-gray-200 px-4 py-2">API base URL</td>
              <td class="border border-gray-200 px-4 py-2">https://api.walits.io</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">api_key</td>
              <td class="border border-gray-200 px-4 py-2">Your API key</td>
              <td class="border border-gray-200 px-4 py-2">bbit_live_xxx</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">api_secret</td>
              <td class="border border-gray-200 px-4 py-2">Your API secret</td>
              <td class="border border-gray-200 px-4 py-2">sk_xxx</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">wallet_id</td>
              <td class="border border-gray-200 px-4 py-2">Test wallet ID</td>
              <td class="border border-gray-200 px-4 py-2">wal_abc123</td>
            </tr>
          </tbody>
        </table>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Included Requests</h2>
        <ul class="list-disc list-inside space-y-2 mb-6">
          <li>‚úÖ Wallets: Create, List, Get, Update, Delete, Get Balance</li>
          <li>‚úÖ Virtual Accounts: Create, List, Get, Internal Transfer</li>
          <li>‚úÖ Withdrawals: Request, Get Status, List History</li>
          <li>‚úÖ Approvals: List, Approve, Reject</li>
          <li>‚úÖ Policies: Create, Update Threshold, Manage Whitelist</li>
          <li>‚úÖ Balances: Omnibus, Virtual Account, Reconciliation</li>
        </ul>
      </section>

      <!-- ============================================ -->
      <!-- SECURITY -->
      <!-- ============================================ -->

      <!-- Security Best Practices -->
      <section id="security-best-practices" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Security Best Practices</h1>

        <h2 class="text-2xl font-semibold mt-8 mb-4">1. API Key Management</h2>
        <div class="bg-red-50 border-l-4 border-red-500 p-6 mb-6">
          <p class="font-semibold text-red-800">üî¥ Never Hardcode API Keys</p>
          <ul class="list-disc list-inside mt-2 space-y-1 text-red-700">
            <li>Never commit API keys to Git repositories</li>
            <li>Never expose keys in client-side code (frontend JavaScript)</li>
            <li>Use environment variables or secret management systems</li>
          </ul>
        </div>

        <h3 class="text-xl font-semibold mt-6 mb-3">‚úÖ Good Practices</h3>
        <pre><code class="language-bash">
# .env file (add to .gitignore!)
BLOCKBIT_API_KEY=bbit_live_xxx
BLOCKBIT_API_SECRET=sk_xxx

# Use environment variables
const apiKey = process.env.BLOCKBIT_API_KEY;
        </code></pre>

        <h3 class="text-xl font-semibold mt-6 mb-3">‚ùå Bad Practices</h3>
        <pre><code class="language-javascript">
// NEVER DO THIS!
const apiKey = 'bbit_live_1234567890abcdef'; // Hardcoded ‚ùå
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">2. Use Separate Keys for Environments</h2>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Environment</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Key Prefix</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Purpose</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Sandbox</td>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">bbit_test_...</td>
              <td class="border border-gray-200 px-4 py-2">Testing, development</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Production</td>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">bbit_live_...</td>
              <td class="border border-gray-200 px-4 py-2">Real funds, live traffic</td>
            </tr>
          </tbody>
        </table>

        <h2 class="text-2xl font-semibold mt-8 mb-4">3. Implement IP Whitelisting</h2>
        <p class="mb-4">Restrict API access to your server IPs only:</p>
        <pre><code class="language-bash">
# Dashboard ‚Üí Settings ‚Üí API Keys ‚Üí Edit
Allowed IPs: 52.1.2.3, 54.5.6.7
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">4. Rotate API Keys Regularly</h2>
        <pre><code class="language-plaintext">
Recommended rotation schedule:
- Production keys: Every 90 days
- After employee offboarding: Immediately
- After suspected compromise: Immediately
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">5. Use Read-Only Keys Where Possible</h2>
        <p class="mb-4">Create separate API keys with limited permissions for different use cases:</p>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Use Case</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Permissions</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2">Balance monitoring dashboard</td>
              <td class="border border-gray-200 px-4 py-2">Read-only (balances, transactions)</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2">Withdrawal processing</td>
              <td class="border border-gray-200 px-4 py-2">Write (withdrawals only)</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2">Admin operations</td>
              <td class="border border-gray-200 px-4 py-2">Full access</td>
            </tr>
          </tbody>
        </table>

        <h2 class="text-2xl font-semibold mt-8 mb-4">6. Validate User Input</h2>
        <pre><code class="language-javascript">
// Always validate addresses before API calls
const ethers = require('ethers');

function isValidEthereumAddress(address) {
  return ethers.utils.isAddress(address);
}

// Sanitize amounts
function sanitizeAmount(amount) {
  const parsed = parseFloat(amount);
  if (isNaN(parsed) || parsed <= 0) {
    throw new Error('Invalid amount');
  }
  return parsed.toFixed(18); // Precision for ETH
}
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">7. Monitor for Anomalies</h2>
        <ul class="list-disc list-inside space-y-2 mb-6">
          <li>Set up alerts for large withdrawals (&gt; $10,000)</li>
          <li>Monitor for unusual API access patterns</li>
          <li>Track failed authentication attempts</li>
          <li>Review approval logs weekly</li>
        </ul>
      </section>

      <!-- Key Management -->
      <section id="key-management" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Key Management</h1>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-6">
          <p class="font-semibold text-lg mb-2">üîë MPC Key Share Management</p>
          <p>In Walits's MPC 2-of-3 setup, you always retain 1/3 of the key share. Proper management of this share is critical.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Key Share Distribution</h2>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Key Share</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Location</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Recommendation</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Your Share (1/3)</td>
              <td class="border border-gray-200 px-4 py-2">Your infrastructure</td>
              <td class="border border-gray-200 px-4 py-2">HSM or secure enclave (AWS KMS, Azure Key Vault)</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Walits Share (1/3)</td>
              <td class="border border-gray-200 px-4 py-2">Walits HSM</td>
              <td class="border border-gray-200 px-4 py-2">Managed by Walits</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Backup Share (1/3)</td>
              <td class="border border-gray-200 px-4 py-2">Secure backup location</td>
              <td class="border border-gray-200 px-4 py-2">Cold storage (offline HSM, paper wallet)</td>
            </tr>
          </tbody>
        </table>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Recommended Storage Solutions</h2>

        <h3 class="text-xl font-semibold mt-6 mb-3">Option 1: Hardware Security Module (HSM)</h3>
        <div class="border rounded-lg p-4 mb-4">
          <p class="font-semibold mb-2">Best for: Large exchanges, institutional custody</p>
          <ul class="list-disc list-inside space-y-1">
            <li>Thales nShield, AWS CloudHSM, Azure Dedicated HSM</li>
            <li>FIPS 140-2 Level 3 compliance</li>
            <li>Tamper-resistant hardware</li>
            <li>Cost: $10,000+ (hardware) or $1,500/month (cloud)</li>
          </ul>
        </div>

        <h3 class="text-xl font-semibold mt-6 mb-3">Option 2: Cloud Key Management Service</h3>
        <div class="border rounded-lg p-4 mb-4">
          <p class="font-semibold mb-2">Best for: Medium-sized platforms</p>
          <ul class="list-disc list-inside space-y-1">
            <li>AWS KMS, Google Cloud KMS, Azure Key Vault</li>
            <li>Easier setup than HSM</li>
            <li>Automatic backups and redundancy</li>
            <li>Cost: $1-3/key/month</li>
          </ul>
        </div>

        <h3 class="text-xl font-semibold mt-6 mb-3">Option 3: Secure Enclave (TEE)</h3>
        <div class="border rounded-lg p-4 mb-4">
          <p class="font-semibold mb-2">Best for: Startups, cost-conscious deployments</p>
          <ul class="list-disc list-inside space-y-1">
            <li>AWS Nitro Enclaves, Intel SGX</li>
            <li>Lower cost than HSM</li>
            <li>Good security for most use cases</li>
            <li>Cost: Included in EC2 pricing</li>
          </ul>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Key Backup Strategy</h2>
        <div class="bg-yellow-50 border-l-4 border-yellow-500 p-6 mb-6">
          <p class="font-semibold mb-2">‚ö†Ô∏è Always Maintain Offline Backups</p>
          <p>Store your 1/3 key share backup in:</p>
          <ul class="list-disc list-inside mt-2 space-y-1">
            <li>Encrypted USB drive in a bank safe deposit box</li>
            <li>Paper wallet (BIP39 mnemonic) in fireproof safe</li>
            <li>Secondary offline HSM in different geographic location</li>
          </ul>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Self-Recovery Process</h2>
        <p class="mb-4">In the unlikely event Walits ceases operations:</p>
        <pre><code class="language-plaintext">
1. Retrieve your key share (1/3) from your HSM/KMS
2. Retrieve backup key share (1/3) from cold storage
3. Use Walits's open-source recovery tool:

   $ npm install -g @walits/key-recovery
   $ walits-recover \
     --share1 ./your-share.json \
     --share2 ./backup-share.json \
     --output ./recovered-private-key.json

4. Import recovered private key into any wallet (MetaMask, Ledger, etc.)
5. Transfer funds to new custody solution
        </code></pre>
      </section>

      <!-- Audit Logs -->
      <section id="audit-logs" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Audit Logs</h1>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-6">
          <p class="font-semibold text-lg mb-2">üìã Comprehensive Activity Logging</p>
          <p>All API actions and admin operations are logged for compliance and forensic analysis.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Retrieve Audit Logs</h2>
        <div class="border rounded-lg p-4 mb-6">
          <p class="mb-4"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm font-mono mr-2">GET</span><code class="bg-gray-100 px-2 py-1 rounded">/audit-logs</code></p>
          <pre><code class="language-bash">
GET /audit-logs?startDate=2024-12-01&endDate=2024-12-09&limit=100
X-API-Key: bbit_live_xxx

# Response
{
  "logs": [
    {
      "id": "log_123abc",
      "timestamp": "2024-12-09T10:30:00Z",
      "action": "WITHDRAWAL_REQUESTED",
      "actor": {
        "type": "API_KEY",
        "id": "key_xyz789",
        "label": "Production API Key"
      },
      "resource": {
        "type": "WALLET",
        "id": "wal_abc123"
      },
      "details": {
        "amount": "5.0",
        "toAddress": "0xRecipient...",
        "approvalRequestId": "apr_xyz789"
      },
      "ipAddress": "52.1.2.3",
      "userAgent": "axios/0.21.1"
    },
    {
      "id": "log_456def",
      "timestamp": "2024-12-09T10:35:00Z",
      "action": "APPROVAL_GRANTED",
      "actor": {
        "type": "ADMIN",
        "id": "admin_001",
        "email": "admin@yourcompany.com"
      },
      "resource": {
        "type": "APPROVAL_REQUEST",
        "id": "apr_xyz789"
      },
      "details": {
        "comment": "Verified and approved"
      },
      "ipAddress": "203.0.113.5"
    }
  ],
  "total": 1547,
  "hasMore": true
}
          </code></pre>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Logged Actions</h2>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Action</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">WALLET_CREATED</td>
              <td class="border border-gray-200 px-4 py-2">New custody wallet created</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">VIRTUAL_ACCOUNT_CREATED</td>
              <td class="border border-gray-200 px-4 py-2">New virtual account (deposit address) created</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">WITHDRAWAL_REQUESTED</td>
              <td class="border border-gray-200 px-4 py-2">Withdrawal approval request submitted</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">APPROVAL_GRANTED</td>
              <td class="border border-gray-200 px-4 py-2">Admin approved a withdrawal</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">APPROVAL_REJECTED</td>
              <td class="border border-gray-200 px-4 py-2">Admin rejected a withdrawal</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">POLICY_UPDATED</td>
              <td class="border border-gray-200 px-4 py-2">Policy parameters changed</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">WHITELIST_ADDRESS_ADDED</td>
              <td class="border border-gray-200 px-4 py-2">Address added to whitelist</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">API_KEY_CREATED</td>
              <td class="border border-gray-200 px-4 py-2">New API key generated</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-mono text-sm">API_KEY_REVOKED</td>
              <td class="border border-gray-200 px-4 py-2">API key deleted/revoked</td>
            </tr>
          </tbody>
        </table>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Export for Compliance</h2>
        <pre><code class="language-bash">
# Export audit logs as CSV
GET /audit-logs/export?format=csv&startDate=2024-01-01&endDate=2024-12-31
X-API-Key: bbit_live_xxx

# Response: CSV file download
# Filename: audit-logs-2024-01-01-to-2024-12-31.csv
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Retention Policy</h2>
        <ul class="list-disc list-inside space-y-2 mb-6">
          <li><strong>Standard Plan:</strong> 90 days retention</li>
          <li><strong>Enterprise Plan:</strong> 7 years retention (for compliance)</li>
          <li><strong>Export:</strong> Download logs anytime for permanent archival</li>
        </ul>
      </section>

      <!-- ============================================ -->
      <!-- APPENDIX -->
      <!-- ============================================ -->

      <!-- Data Objects -->
      <section id="data-objects" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Data Objects</h1>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Wallet Object</h2>
        <pre><code class="language-json">
{
  "id": "wal_abc123",
  "name": "Exchange Master Wallet",
  "coinType": "ETHEREUM",
  "walletType": "CUSTODY_HOT",
  "signatureProtocol": "MPC",
  "omnibusAddress": "0x9F8f72aA9304c8B593d555F12eF6589cC3A579A2",
  "balance": "1234.5678",
  "policyId": "pol_abc123",
  "autoSweep": true,
  "sweepThreshold": "0.1",
  "createdAt": "2024-12-09T10:00:00Z",
  "updatedAt": "2024-12-09T11:00:00Z"
}
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">VirtualAccount Object</h2>
        <pre><code class="language-json">
{
  "virtualAccountId": "va_xyz789",
  "walletId": "wal_abc123",
  "userId": "user_12345",
  "label": "John Doe - ETH Account",
  "depositAddress": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb",
  "balance": "10.5",
  "createdAt": "2024-12-08T10:00:00Z"
}
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">ApprovalRequest Object</h2>
        <pre><code class="language-json">
{
  "approvalRequestId": "apr_xyz789",
  "walletId": "wal_abc123",
  "type": "WITHDRAWAL",
  "status": "PENDING",
  "amount": "5.0",
  "toAddress": "0xRecipient...",
  "fromAddress": "0xOMNIBUS...",
  "requiredApprovals": 2,
  "currentApprovals": 1,
  "approvers": [
    {
      "adminId": "admin_001",
      "approvedAt": "2024-12-09T10:05:00Z",
      "comment": "Verified"
    }
  ],
  "createdAt": "2024-12-09T10:00:00Z",
  "txHash": null
}
        </code></pre>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Policy Object</h2>
        <pre><code class="language-json">
{
  "id": "pol_abc123",
  "name": "Standard Security Policy",
  "approvalThreshold": 2,
  "maxDailyLimit": "100.0",
  "maxMonthlyLimit": "2000.0",
  "whitelistOnly": true,
  "autoApproveWhitelisted": false,
  "createdAt": "2024-12-09T10:00:00Z"
}
        </code></pre>
      </section>

      <!-- Integration Checklist -->
      <section id="integration-checklist" class="content-section">
        <h1 class="text-4xl font-bold mb-6">Integration Checklist</h1>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-6">
          <p class="font-semibold text-lg mb-2">‚úÖ Complete Integration Guide</p>
          <p>Follow this checklist to ensure a smooth integration with Walits Custody API.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Phase 1: Setup (Day 1)</h2>
        <ul class="space-y-3 mb-6">
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Sign up for Walits account</strong> at https://dashboard.walits.io</span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Generate sandbox API keys</strong> for testing</span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Install SDK</strong>: npm install @walits/custody-sdk</span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Import Postman collection</strong> to test API endpoints</span>
          </li>
        </ul>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Phase 2: Development (Week 1)</h2>
        <ul class="space-y-3 mb-6">
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Create test custody wallet</strong> (POST /wallets/custody)</span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Create virtual accounts</strong> for 3-5 test users</span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Configure policy</strong>: approval threshold, daily limit, whitelist</span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Test deposit flow</strong>: send testnet ETH to deposit address</span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Test withdrawal flow</strong>: request, approve, confirm</span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Set up webhook endpoint</strong> and verify signature validation</span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Implement error handling</strong> with exponential backoff</span>
          </li>
        </ul>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Phase 3: Testing (Week 2)</h2>
        <ul class="space-y-3 mb-6">
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Load testing</strong>: 100+ virtual accounts, 1000+ deposits</span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Test policy enforcement</strong>: exceed daily limit, non-whitelisted address</span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Test approval workflow</strong>: 2-of-3, 3-of-5 multisig</span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Test reconciliation</strong>: verify omnibus balance matches virtual account sum</span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Test idempotency</strong>: duplicate withdrawal requests</span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Security audit</strong>: penetration testing, code review</span>
          </li>
        </ul>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Phase 4: Production Prep (Week 3)</h2>
        <ul class="space-y-3 mb-6">
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Generate production API keys</strong></span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Configure IP whitelisting</strong> for production keys</span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Set up key management</strong>: HSM, KMS, or secure enclave</span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Create production wallet</strong> with real policy configuration</span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Configure monitoring</strong>: error rates, webhook latency, balance discrepancies</span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Set up alerts</strong>: large withdrawals, failed approvals, API errors</span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Document runbook</strong>: incident response, key recovery process</span>
          </li>
        </ul>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Phase 5: Launch (Week 4)</h2>
        <ul class="space-y-3 mb-6">
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Soft launch</strong>: 10-20 beta users</span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Monitor for 48 hours</strong>: check logs, webhooks, reconciliation</span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Full launch</strong>: open to all users</span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Weekly reconciliation reports</strong>: omnibus vs virtual accounts</span>
          </li>
          <li class="flex items-start">
            <input type="checkbox" class="mt-1 mr-3">
            <span><strong>Monthly audit log review</strong>: compliance check</span>
          </li>
        </ul>
      </section>

      <!-- FAQ -->
      <section id="faq" class="content-section active">
        <h1 class="text-4xl font-bold mb-6">FAQ</h1>

        <div class="space-y-6">
          <div class="border-l-4 border-blue-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">Q: What happens if Walits goes out of business?</h3>
            <p><strong>A:</strong> You always retain 1/3 of the MPC key share. With your share (1/3) + backup share (1/3) = 2/3, you can reconstruct the full private key and recover your funds using our open-source recovery tool. This is the industry's first <strong>self-recovery mechanism</strong>, eliminating single point of failure (SPOF) risks present in Fireblocks/BitGo.</p>
          </div>

          <div class="border-l-4 border-green-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">Q: How long does MPC signing take?</h3>
            <p><strong>A:</strong> ~1.5 seconds per signature using CGGMP24 protocol (vs Fireblocks' 3-5 seconds). Key generation takes &lt;30 seconds.</p>
          </div>

          <div class="border-l-4 border-purple-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">Q: What's the difference between Custody and Non-Custody wallets?</h3>
            <p><strong>A:</strong></p>
            <ul class="list-disc list-inside mt-2 space-y-1">
              <li><strong>Custody:</strong> Omnibus system with virtual accounts. Best for exchanges/platforms managing user funds. Supports auto-sweep, policy engine, approval workflows.</li>
              <li><strong>Non-Custody:</strong> Each user gets their own blockchain wallet (TEE-protected). Best for retail apps where users control their keys. Instant virtual balance transfers.</li>
            </ul>
          </div>

          <div class="border-l-4 border-orange-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">Q: Can I change the approval threshold dynamically?</h3>
            <p><strong>A:</strong> Yes! Unlike Fireblocks (where threshold is fixed at wallet creation), Walits allows real-time policy updates via PUT /wallets/custody/{walletId}/policy/approval-threshold.</p>
          </div>

          <div class="border-l-4 border-red-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">Q: How are gas fees handled?</h3>
            <p><strong>A:</strong></p>
            <ul class="list-disc list-inside mt-2 space-y-1">
              <li><strong>Sweeps:</strong> Gas deducted from deposited amount (e.g., 10 ETH deposit ‚Üí 9.999 ETH after sweep)</li>
              <li><strong>Withdrawals:</strong> Gas deducted from omnibus balance</li>
              <li><strong>Gas optimization:</strong> Walits batches sweeps during low-fee periods for 60-80% savings</li>
            </ul>
          </div>

          <div class="border-l-4 border-yellow-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">Q: What blockchains are supported?</h3>
            <p><strong>A:</strong> Currently: Ethereum, Bitcoin, Polygon, Arbitrum, Optimism. Roadmap Q1 2025: Solana, Base, Avalanche. Request new chains at support@walits.com.</p>
          </div>

          <div class="border-l-4 border-pink-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">Q: How do I reconcile balances?</h3>
            <p><strong>A:</strong> Use GET /wallets/{walletId}/reconciliation to verify omnibus on-chain balance matches the sum of all virtual account balances. Run this daily as part of compliance procedures.</p>
          </div>

          <div class="border-l-4 border-indigo-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">Q: Can I use Walits for NFTs?</h3>
            <p><strong>A:</strong> Yes! Custody wallets support ERC-721/ERC-1155. Use the same withdrawal flow, specifying token contract address and token ID.</p>
          </div>

          <div class="border-l-4 border-gray-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">Q: What's the pricing model?</h3>
            <p><strong>A:</strong></p>
            <ul class="list-disc list-inside mt-2 space-y-1">
              <li><strong>Starter:</strong> $12K/year base + $0.01-0.05 per transaction</li>
              <li><strong>Growth:</strong> $30K/year base + volume discounts</li>
              <li><strong>Enterprise:</strong> Custom pricing (100+ wallets, $10B+ AUC)</li>
              <li>vs Fireblocks: $100K+/year + $0.10-0.50 per tx</li>
            </ul>
          </div>

          <div class="border-l-4 border-teal-500 pl-6">
            <h3 class="text-xl font-semibold mb-2">Q: Do you provide insurance for funds?</h3>
            <p><strong>A:</strong> Enterprise customers can opt into $100M+ insurance coverage (via Lloyds of London) for an additional fee. Contact sales@walits.com for details.</p>
          </div>
        </div>
      </section>

    </main>
  </div>

  <footer class="border-t border-gray-200 py-8 bg-white mt-auto">
    <div class="container mx-auto px-6 text-center text-gray-500 text-sm">
      <p>¬© 2024 Walits. All rights reserved.</p>
      <p class="mt-2">Need help? Contact <a href="mailto:support@walits.com" class="text-blue-600 hover:underline">support@walits.com</a></p>
    </div>
  </footer>

  <script>
    // Menu navigation
    document.querySelectorAll('.menu-item').forEach(item => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        const targetId = item.getAttribute('href').substring(1);
        document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
        item.classList.add('active');
        document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
        document.getElementById(targetId).classList.add('active');
        window.scrollTo(0, 0);
      });
    });

    Prism.highlightAll();
  </script>
</body>
</html>
