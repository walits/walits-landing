<h1 class="text-4xl font-bold mb-6">Balance Verification</h1>

        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-6">
          <p class="font-semibold text-lg mb-2">Multi-Layer Verification Strategy</p>
          <p>Walits employs a cost-effective verification strategy that balances accuracy, performance, and blockchain RPC costs.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Verification Layers</h2>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Layer</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Trigger</th>
              <th class="border border-gray-200 px-4 py-3 text-left">RPC Call</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Purpose</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Real-time Updates</td>
              <td class="border border-gray-200 px-4 py-2">Every deposit/withdrawal</td>
              <td class="border border-gray-200 px-4 py-2 text-red-600">No</td>
              <td class="border border-gray-200 px-4 py-2">Fast, DB-based balance tracking</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Sweep Verification</td>
              <td class="border border-gray-200 px-4 py-2">Before every sweep</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600">Yes</td>
              <td class="border border-gray-200 px-4 py-2">Verify exact on-chain balance before moving funds</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Large Withdrawal Check</td>
              <td class="border border-gray-200 px-4 py-2">Withdrawals ≥ 1.0 ETH</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600">Yes</td>
              <td class="border border-gray-200 px-4 py-2">Extra safety for high-value transactions</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2 font-semibold">Daily Reconciliation</td>
              <td class="border border-gray-200 px-4 py-2">Automated cron (2 AM)</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600">Yes (all wallets)</td>
              <td class="border border-gray-200 px-4 py-2">Detect and alert on any discrepancies</td>
            </tr>
          </tbody>
        </table>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Reconciliation Process</h2>
        <p class="mb-4">Every day at 2:00 AM (configurable), an automated reconciliation service:</p>
        <div class="bg-gray-100 p-6 rounded-lg mb-6">
          <ol class="list-decimal list-inside space-y-3">
            <li>Queries all custody wallet addresses from database</li>
            <li>Calls <code class="bg-gray-200 px-2 py-1 rounded">eth_getBalance</code> for each address</li>
            <li>Compares on-chain balance with database balance</li>
            <li>If mismatch detected:
              <ul class="list-disc list-inside ml-6 mt-2 space-y-1">
                <li>Checks for pending sweep transactions</li>
                <li>Checks for pending withdrawals</li>
                <li>Analyzes recent transaction activity (last 30 min)</li>
                <li>Sends alert to operations team</li>
              </ul>
            </li>
            <li>Generates reconciliation report with:
              <ul class="list-disc list-inside ml-6 mt-2 space-y-1">
                <li>Total wallets checked</li>
                <li>Matched wallets</li>
                <li>Discrepancies (with possible reasons)</li>
                <li>Recommended actions</li>
              </ul>
            </li>
          </ol>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Cost Optimization</h2>
        <table class="w-full border border-gray-200 mb-6">
          <thead class="bg-gray-50">
            <tr>
              <th class="border border-gray-200 px-4 py-3 text-left">Strategy</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Monthly RPC Calls</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Est. Cost</th>
              <th class="border border-gray-200 px-4 py-3 text-left">Status</th>
            </tr>
          </thead>
          <tbody>
            <tr class="bg-red-50">
              <td class="border border-gray-200 px-4 py-2">Verify every deposit</td>
              <td class="border border-gray-200 px-4 py-2">86,400,000</td>
              <td class="border border-gray-200 px-4 py-2">$500-1,000</td>
              <td class="border border-gray-200 px-4 py-2 text-red-600">Not recommended</td>
            </tr>
            <tr class="bg-green-50">
              <td class="border border-gray-200 px-4 py-2">Sweep + Large withdrawals only</td>
              <td class="border border-gray-200 px-4 py-2">~10,000</td>
              <td class="border border-gray-200 px-4 py-2">$5-15</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600">✅ Current implementation</td>
            </tr>
            <tr>
              <td class="border border-gray-200 px-4 py-2">Daily reconciliation</td>
              <td class="border border-gray-200 px-4 py-2">~1,500</td>
              <td class="border border-gray-200 px-4 py-2">$1-3</td>
              <td class="border border-gray-200 px-4 py-2 text-green-600">✅ Current implementation</td>
            </tr>
          </tbody>
        </table>

        <div class="bg-green-50 border-l-4 border-green-500 p-6 mb-6">
          <p class="font-semibold text-green-900 mb-2">Total Monthly Cost: $6-18</p>
          <p class="text-green-800">By strategically choosing WHEN to verify on-chain balances, Walits achieves 99.9% accuracy at less than 2% the cost of naive verification approaches.</p>
        </div>

        <h2 class="text-2xl font-semibold mt-8 mb-4">Accessing Reconciliation Reports</h2>
        <pre><code class="language-bash">
# Get latest reconciliation report
GET /api/reconciliation/latest
Authorization: Bearer {ADMIN_JWT_TOKEN}

# Response
{
  "id": "rec_abc123",
  "reportDate": "2025-12-12T02:00:00Z",
  "status": "COMPLETED",
  "totalWallets": 100,
  "matchedWallets": 98,
  "discrepancies": 2,
  "totalDiscrepancyAmount": "0.05",
  "items": [
    {
      "walletId": "wal_xyz",
      "walletName": "Main Custody",
      "dbBalance": "1.5000",
      "chainBalance": "1.5200",
      "difference": "0.0200",
      "matched": false,
      "possibleReasons": [
        "1 Sweep transaction pending (BROADCAST status)"
      ]
    }
  ]
}
        </code></pre>